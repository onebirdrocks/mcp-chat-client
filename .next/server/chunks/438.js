exports.id=438,exports.ids=[438],exports.modules={78335:()=>{},79985:(a,b,c)=>{"use strict";c.d(b,{PO:()=>g,m_:()=>f,yI:()=>e}),c(32190);class d extends Error{constructor(a,b=500,c=!0){super(a),this.statusCode=b,this.isOperational=c,Error.captureStackTrace(this,this.constructor)}}class e extends d{constructor(a){super(a,400)}}class f extends d{constructor(a="Resource not found"){super(a,404)}}class g extends d{constructor(a="Internal server error"){super(a,500)}}},91034:(a,b,c)=>{"use strict";c.d(b,{wF:()=>j});var d=c(29021),e=c(33873),f=c(79985),g=c(91291);class h{constructor(a="./data/sessions",b=1e3,c=864e5){this.encryptionService=(0,g.J)(),this.storageDir=a,this.storageFile=e.join(a,"sessions.json"),this.maxSessions=b,this.cleanupIntervalMs=c,this.storage={sessions:{},metadata:{lastCleanup:new Date().toISOString(),totalSessions:0,version:"1.0.0",encrypted:!1}}}async initialize(){try{await this.ensureStorageDirectory(),await this.loadSessions(),this.startCleanupTimer()}catch(a){throw console.error("Failed to initialize SessionManager:",a),new f.PO("Failed to initialize session storage")}}async createSession(a,b,c=[],d){let e=this.generateSessionId(),f=new Date,g={id:e,title:"New Chat",messages:d?[d]:[],createdAt:f,updatedAt:f,provider:a,model:b,mcpServers:c};return this.storage.sessions[e]=g,this.storage.metadata.totalSessions=Object.keys(this.storage.sessions).length,await this.saveSessions(),g}async getSession(a){let b=this.storage.sessions[a];if(!b)throw new f.m_(`Session with ID ${a} not found`);return{...b}}async updateSession(a,b){let c=this.storage.sessions[a];if(!c)throw new f.m_(`Session with ID ${a} not found`);let{id:d,createdAt:e,...g}=b,h={...c,...g,updatedAt:new Date};return this.storage.sessions[a]=h,await this.saveSessions(),{...h}}async addMessage(a,b){let c=this.storage.sessions[a];if(!c)throw new f.m_(`Session with ID ${a} not found`);return c.messages.push(b),c.updatedAt=new Date,this.storage.sessions[a]=c,await this.saveSessions(),{...c}}async deleteSession(a){if(!this.storage.sessions[a])throw new f.m_(`Session with ID ${a} not found`);delete this.storage.sessions[a],this.storage.metadata.totalSessions=Object.keys(this.storage.sessions).length,await this.saveSessions()}async searchSessions(a={}){let{query:b,provider:c,limit:d=50,offset:e=0,sortBy:f="updatedAt",sortOrder:g="desc"}=a,h=Object.values(this.storage.sessions);if(b){let a=b.toLowerCase();h=h.filter(b=>b.title.toLowerCase().includes(a)||b.messages.some(b=>b.content.toLowerCase().includes(a)))}c&&(h=h.filter(a=>a.provider===c)),h.sort((a,b)=>{let c=a[f],d=b[f],e=0;return e=c instanceof Date&&d instanceof Date?c.getTime()-d.getTime():String(c).localeCompare(String(d)),"desc"===g?-e:e});let i=h.length;return{sessions:h.slice(e,e+d).map(a=>({id:a.id,title:a.title,createdAt:a.createdAt.toISOString(),updatedAt:a.updatedAt.toISOString(),messageCount:a.messages.length,provider:a.provider,model:a.model})),total:i,hasMore:e+d<i}}async getAllSessions(){return Object.values(this.storage.sessions)}async generateSessionTitle(a,b){let c=this.storage.sessions[a];if(!c)throw new f.m_(`Session with ID ${a} not found`);if(!b||0===c.messages.length)return this.generateFallbackTitle(c);try{let d=c.messages.filter(a=>"user"===a.role||"assistant"===a.role).slice(0,4).map(a=>`${a.role}: ${a.content.substring(0,200)}`).join("\n"),e=`Based on this conversation, generate a concise, descriptive title (max 50 characters):

${d}

Title:`,f=await b.generateCompletion({messages:[{role:"user",content:e}],maxTokens:20,temperature:.3}),g=f.content?.trim().replace(/^["']|["']$/g,"").substring(0,50)||this.generateFallbackTitle(c);return await this.updateSession(a,{title:g}),g}catch(a){return console.error("Failed to generate session title:",a),this.generateFallbackTitle(c)}}async cleanupSessions(){let a=Object.values(this.storage.sessions),b=new Date,c=0;for(let d of a.filter(a=>b.getTime()-a.updatedAt.getTime()>2592e6))delete this.storage.sessions[d.id],c++;let d=Object.values(this.storage.sessions);if(d.length>this.maxSessions)for(let a of d.sort((a,b)=>a.updatedAt.getTime()-b.updatedAt.getTime()).slice(0,d.length-this.maxSessions))delete this.storage.sessions[a.id],c++;return this.storage.metadata.lastCleanup=b.toISOString(),this.storage.metadata.totalSessions=Object.keys(this.storage.sessions).length,c>0&&await this.saveSessions(),{deletedCount:c}}getStatistics(){let a=Object.values(this.storage.sessions),b={openai:0,deepseek:0,openrouter:0},c=0;return a.forEach(a=>{b[a.provider]++,c+=a.messages.length}),{totalSessions:a.length,lastCleanup:this.storage.metadata.lastCleanup,providerBreakdown:b,averageMessagesPerSession:a.length>0?c/a.length:0}}async exportChatHistory(a={}){let{sessionIds:b,dateFrom:c,dateTo:d,includeSystemMessages:e=!1}=a,f=Object.values(this.storage.sessions);b&&b.length>0&&(f=f.filter(a=>b.includes(a.id))),c&&(f=f.filter(a=>a.createdAt>=c)),d&&(f=f.filter(a=>a.createdAt<=d));let g=f.map(a=>({...a,messages:e?a.messages:a.messages.filter(a=>"system"!==a.role)})),h=g.map(a=>a.createdAt).sort(),i=h.length>0?h[0].toISOString():new Date().toISOString(),j=h.length>0?h[h.length-1].toISOString():new Date().toISOString();return{version:"1.0.0",exportDate:new Date().toISOString(),sessions:g,metadata:{totalSessions:g.length,dateRange:{earliest:i,latest:j}}}}async importChatHistory(a,b={}){let{overwriteExisting:c=!1,generateNewIds:d=!1}=b,e=0,g=0,h=[];try{if("1.0.0"!==a.version)throw new f.yI("Unsupported export version");for(let b of a.sessions)try{let a=b.id;if((d||this.storage.sessions[a]&&!c)&&(a=this.generateSessionId()),this.storage.sessions[a]&&!c){g++;continue}let f={...b,id:a,createdAt:new Date(b.createdAt),updatedAt:new Date(b.updatedAt),messages:b.messages.map(a=>({...a,timestamp:new Date(a.timestamp)}))};this.storage.sessions[a]=f,e++}catch(a){h.push(`Failed to import session ${b.id}: ${a}`)}return this.storage.metadata.totalSessions=Object.keys(this.storage.sessions).length,await this.saveSessions(),{imported:e,skipped:g,errors:h}}catch(a){throw console.error("Failed to import chat history:",a),new f.PO("Failed to import chat history")}}async secureCleanup(a={}){let{olderThanDays:b=30,sessionIds:c,clearAllSensitiveData:d=!1}=a,e=0,f=new Date,g=24*b*36e5;if(c&&c.length>0)for(let a of c)this.storage.sessions[a]&&(delete this.storage.sessions[a],e++);else for(let a of Object.values(this.storage.sessions).filter(a=>f.getTime()-a.updatedAt.getTime()>g))delete this.storage.sessions[a.id],e++;let h=!1;return d&&(Object.values(this.storage.sessions).forEach(a=>{a.messages=a.messages.map(a=>({...a,content:this.sanitizeMessageContent(a.content)}))}),h=!0),this.storage.metadata.totalSessions=Object.keys(this.storage.sessions).length,this.storage.metadata.lastCleanup=f.toISOString(),await this.saveSessions(),{deletedSessions:e,clearedData:h}}getPrivacyStatistics(){let a=Object.values(this.storage.sessions),b=new Date;if(0===a.length)return{totalSessions:0,totalMessages:0,oldestSession:null,newestSession:null,averageSessionAge:0,sessionsWithSensitiveData:0,lastCleanup:this.storage.metadata.lastCleanup};let c=a.sort((a,b)=>a.createdAt.getTime()-b.createdAt.getTime()),d=a.reduce((a,b)=>a+b.messages.length,0),e=a.reduce((a,c)=>a+(b.getTime()-c.createdAt.getTime()),0)/a.length/864e5,f=[/api[_-]?key/i,/token/i,/secret/i,/password/i],g=a.filter(a=>a.messages.some(a=>f.some(b=>b.test(a.content)))).length;return{totalSessions:a.length,totalMessages:d,oldestSession:c[0].createdAt.toISOString(),newestSession:c[c.length-1].createdAt.toISOString(),averageSessionAge:e,sessionsWithSensitiveData:g,lastCleanup:this.storage.metadata.lastCleanup}}async shutdown(){this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=void 0),await this.saveSessions()}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generateFallbackTitle(a){let b=a.messages.filter(a=>"user"===a.role);if(b.length>0){let a=b[0].content,c=a.substring(0,40);return a.length>40?`${c}...`:c}let c=a.createdAt.toLocaleDateString();return`Chat from ${c}`}async ensureStorageDirectory(){try{await d.promises.mkdir(this.storageDir,{recursive:!0})}catch(a){throw new f.PO(`Failed to create storage directory: ${a}`)}}async loadSessions(){try{let a=await d.promises.readFile(this.storageFile,"utf-8"),b=JSON.parse(a);Object.values(b.sessions).forEach(a=>{a.createdAt=new Date(a.createdAt),a.updatedAt=new Date(a.updatedAt),a.messages.forEach(a=>{a.timestamp=new Date(a.timestamp)})}),this.storage=b}catch(a){if("ENOENT"===a.code)this.storage={sessions:{},metadata:{lastCleanup:new Date().toISOString(),totalSessions:0,version:"1.0.0",encrypted:!1}},await this.saveSessions();else throw console.error("Failed to load sessions:",a),new f.PO("Failed to load session data")}}async saveSessions(){try{let a=JSON.stringify(this.storage,null,2);await d.promises.writeFile(this.storageFile,a,"utf-8")}catch(a){throw console.error("Failed to save sessions:",a),new f.PO("Failed to save session data")}}startCleanupTimer(){this.cleanupTimer=setInterval(async()=>{try{await this.cleanupSessions()}catch(a){console.error("Automatic cleanup failed:",a)}},this.cleanupIntervalMs)}sanitizeMessageContent(a){let b=a;return[/sk-[a-zA-Z0-9]{20,}/g,/sk-or-[a-zA-Z0-9]{30,}/g,/Bearer\s+[a-zA-Z0-9]{20,}/g,/[a-zA-Z0-9]{32,}/g].forEach(a=>{b=b.replace(a,"[REDACTED]")}),b}}let i=null;function j(){return i||(i=new h),i}},91291:(a,b,c)=>{"use strict";c.d(b,{J:()=>h});var d=c(46690),e=c(79985);class f{constructor(){this.secretKey=process.env.ENCRYPTION_KEY||this.generateDefaultKey(),process.env.ENCRYPTION_KEY||console.warn("ENCRYPTION_KEY not set in environment. Using generated key. This is not secure for production!")}encrypt(a){try{if(!a)return"";return d.AES.encrypt(a,this.secretKey).toString()}catch(a){throw console.error("Encryption failed:",a),new e.PO("Failed to encrypt data")}}decrypt(a){try{if(!a)return"";let b=d.AES.decrypt(a,this.secretKey).toString(d.enc.Utf8);if(!b)throw Error("Failed to decrypt data - invalid key or corrupted data");return b}catch(a){throw console.error("Decryption failed:",a),new e.PO("Failed to decrypt data")}}hash(a){try{return d.SHA256(a).toString()}catch(a){throw console.error("Hashing failed:",a),new e.PO("Failed to hash data")}}generateSecureKey(){return d.lib.WordArray.random(32).toString()}maskApiKey(a){if(!a||a.length<8)return"••••";let b=Math.min(8,Math.max(0,a.length-4));return"•".repeat(b)+a.slice(-4)}isEncrypted(a){try{return this.decrypt(a),!0}catch{return!1}}generateDefaultKey(){let a=process.platform+process.arch+(process.env.HOME||process.env.USERPROFILE||"default");return d.SHA256(a+"mcp-chat-ui-default-key").toString()}}let g=null;function h(){return g||(g=new f),g}},96487:()=>{}};
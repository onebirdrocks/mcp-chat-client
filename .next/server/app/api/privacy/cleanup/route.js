(()=>{var a={};a.id=927,a.ids=[927],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1291:(a,b,c)=>{"use strict";c.d(b,{J:()=>h});var d=c(6690),e=c(9985);class f{constructor(){this.secretKey=process.env.ENCRYPTION_KEY||this.generateDefaultKey(),process.env.ENCRYPTION_KEY||console.warn("ENCRYPTION_KEY not set in environment. Using generated key. This is not secure for production!")}encrypt(a){try{if(!a)return"";return d.AES.encrypt(a,this.secretKey).toString()}catch(a){throw console.error("Encryption failed:",a),new e.PO("Failed to encrypt data")}}decrypt(a){try{if(!a)return"";let b=d.AES.decrypt(a,this.secretKey).toString(d.enc.Utf8);if(!b)throw Error("Failed to decrypt data - invalid key or corrupted data");return b}catch(a){throw console.error("Decryption failed:",a),new e.PO("Failed to decrypt data")}}hash(a){try{return d.SHA256(a).toString()}catch(a){throw console.error("Hashing failed:",a),new e.PO("Failed to hash data")}}generateSecureKey(){return d.lib.WordArray.random(32).toString()}maskApiKey(a){if(!a||a.length<8)return"••••";let b=Math.min(8,Math.max(0,a.length-4));return"•".repeat(b)+a.slice(-4)}isEncrypted(a){try{return this.decrypt(a),!0}catch{return!1}}generateDefaultKey(){let a=process.platform+process.arch+(process.env.HOME||process.env.USERPROFILE||"default");return d.SHA256(a+"mcp-chat-ui-default-key").toString()}}let g=null;function h(){return g||(g=new f),g}},1986:(a,b,c)=>{"use strict";c.d(b,{cQ:()=>j});var d=c(9021),e=c(3873),f=c(1291),g=c(9985);class h{constructor(a="./data/settings"){this.encryptionService=(0,f.J)(),this.settingsDir=a,this.settingsFile=e.join(a,"settings.json"),this.settings=this.getDefaultSettings()}async initialize(){try{await this.ensureSettingsDirectory(),await this.loadSettings()}catch(a){throw console.error("Failed to initialize SecureSettingsManager:",a),new g.PO("Failed to initialize settings storage")}}async getSettings(){let a={...this.settings};return a.llmProviders=a.llmProviders.map(a=>({...a,apiKey:this.encryptionService.maskApiKey(a.apiKey?this.encryptionService.decrypt(a.apiKey):"")})),a}async updateSettings(a){try{if(a.llmProviders){let b=[];for(let c of a.llmProviders){let a=this.settings.llmProviders.find(a=>a.id===c.id),d="",e="";c.apiKey&&(c.apiKey.includes("*")||c.apiKey.includes("•")?a&&(d=a.apiKey,e=a.apiKeyHash||""):(d=this.encryptionService.encrypt(c.apiKey),e=this.encryptionService.hash(c.apiKey))),b.push({...c,apiKey:d,apiKeyHash:e})}this.settings.llmProviders=b}return a.mcpServers&&(this.settings.mcpServers=a.mcpServers),a.preferences&&(this.settings.preferences={...this.settings.preferences,...a.preferences}),await this.saveSettings(),this.getSettings()}catch(a){throw console.error("Failed to update settings:",a),new g.PO("Failed to update settings")}}async getDecryptedApiKey(a){let b=this.settings.llmProviders.find(b=>b.id===a);if(!b||!b.apiKey)throw new g.yI(`API key not found for provider: ${a}`);try{return this.encryptionService.decrypt(b.apiKey)}catch(b){throw console.error(`Failed to decrypt API key for provider ${a}:`,b),new g.PO("Failed to decrypt API key")}}async validateApiKey(a,b,c){if(!b||b.length<10)return!1;switch(a){case"openai":case"deepseek":return b.startsWith("sk-")&&b.length>20;case"openrouter":return b.startsWith("sk-or-")&&b.length>30;default:return b.length>10}}async exportSettings(){return{version:"1.0.0",exportDate:new Date().toISOString(),settings:{preferences:this.settings.preferences,mcpServers:this.settings.mcpServers.map(a=>({...a,env:a.env?this.sanitizeEnvironmentVariables(a.env):void 0}))}}}async importSettings(a){try{if("1.0.0"!==a.version)throw new g.yI("Unsupported settings export version");await this.updateSettings({preferences:a.settings.preferences,mcpServers:a.settings.mcpServers})}catch(a){throw console.error("Failed to import settings:",a),new g.PO("Failed to import settings")}}async clearSensitiveData(){this.settings.llmProviders=this.settings.llmProviders.map(a=>({...a,apiKey:"",apiKeyHash:""})),await this.saveSettings()}getStatistics(){let a=this.settings.llmProviders.filter(a=>a.apiKey).length,b=this.settings.mcpServers.filter(a=>a.enabled).length;return{totalProviders:this.settings.llmProviders.length,providersWithKeys:a,totalMcpServers:this.settings.mcpServers.length,enabledMcpServers:b,lastUpdated:new Date().toISOString()}}getDefaultSettings(){return{llmProviders:[{id:"openai-1",name:"openai",apiKey:"",baseUrl:"https://api.openai.com/v1",models:[{id:"gpt-4",name:"GPT-4",supportsToolCalling:!0,maxTokens:8192},{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo",supportsToolCalling:!0,maxTokens:4096}]},{id:"deepseek-1",name:"deepseek",apiKey:"",baseUrl:"https://api.deepseek.com/v1",models:[{id:"deepseek-chat",name:"DeepSeek Chat",supportsToolCalling:!0,maxTokens:4096}]},{id:"openrouter-1",name:"openrouter",apiKey:"",baseUrl:"https://openrouter.ai/api/v1",models:[{id:"openai/gpt-4",name:"GPT-4 (OpenRouter)",supportsToolCalling:!0,maxTokens:8192}]}],mcpServers:[{id:"filesystem-1",name:"filesystem",command:"npx",args:["-y","@modelcontextprotocol/server-filesystem","/tmp"],enabled:!1,status:"disconnected"}],preferences:{theme:"system",language:"en",autoScroll:!0,soundEnabled:!1}}}async ensureSettingsDirectory(){try{await d.promises.mkdir(this.settingsDir,{recursive:!0})}catch(a){throw new g.PO(`Failed to create settings directory: ${a}`)}}async loadSettings(){try{let a=await d.promises.readFile(this.settingsFile,"utf-8"),b=JSON.parse(a);this.settings={...this.getDefaultSettings(),...b}}catch(a){if("ENOENT"===a.code)this.settings=this.getDefaultSettings(),await this.saveSettings();else throw console.error("Failed to load settings:",a),new g.PO("Failed to load settings data")}}async saveSettings(){try{let a=JSON.stringify(this.settings,null,2);await d.promises.writeFile(this.settingsFile,a,"utf-8")}catch(a){throw console.error("Failed to save settings:",a),new g.PO("Failed to save settings data")}}sanitizeEnvironmentVariables(a){let b={},c=["api_key","secret","token","password","key"];for(let[d,e]of Object.entries(a)){let a=d.toLowerCase();c.some(b=>a.includes(b))?b[d]="[REDACTED]":b[d]=e}return b}}let i=null;function j(){return i||(i=new h),i}},2277:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>L,patchFetch:()=>K,routeModule:()=>G,serverHooks:()=>J,workAsyncStorage:()=>H,workUnitAsyncStorage:()=>I});var d={};c.r(d),c.d(d,{GET:()=>A,POST:()=>z,runtime:()=>y});var e=c(6559),f=c(8088),g=c(7719),h=c(6191),i=c(1289),j=c(261),k=c(2603),l=c(9893),m=c(4823),n=c(7220),o=c(6946),p=c(7912),q=c(9786),r=c(6143),s=c(6439),t=c(5746),u=c(2190),v=c(9748),w=c(3873),x=c(1986);let y="nodejs";async function z(a){try{let b=await a.json();if(!b.confirmed)return u.NextResponse.json({success:!1,error:"Cleanup must be explicitly confirmed"},{status:400});if(!["sessions","settings","all"].includes(b.type))return u.NextResponse.json({success:!1,error:'Invalid cleanup type. Must be "sessions", "settings", or "all"'},{status:400});let c=0,d=[],e=0,f=0,g=!1;if("sessions"===b.type||"all"===b.type){let a=await B(b);c+=a.deletedCount,e+=a.dataFreed,f=a.deletedCount,d.push(...a.clearedData)}if("settings"===b.type||"all"===b.type){let a=await C(b);a.cleared&&(g=!0,d.push(...a.clearedData))}await E();let h={deletedCount:c,clearedData:d,success:!0,summary:{sessionsDeleted:f,settingsCleared:g,dataFreed:e}};return u.NextResponse.json({success:!0,data:h,message:`Cleanup completed. ${c} items processed.`})}catch(a){return console.error("Failed to perform privacy cleanup:",a),u.NextResponse.json({success:!1,error:"Failed to perform privacy cleanup"},{status:500})}}async function A(){try{let a=await F();return u.NextResponse.json({success:!0,data:a})}catch(a){return console.error("Failed to generate privacy report:",a),u.NextResponse.json({success:!1,error:"Failed to generate privacy report"},{status:500})}}async function B(a){let b=(0,w.join)(process.cwd(),"data","sessions"),d=0,e=0,f=[];try{await (0,v.access)(b)}catch{return{deletedCount:0,dataFreed:0,clearedData:[]}}let g=(await (0,v.readdir)(b)).filter(a=>a.endsWith(".json")),h=[];for(let a of g)try{let d=(0,w.join)(b,a),e=await (0,v.readFile)(d,"utf-8"),f=await Promise.resolve().then(c.t.bind(c,9021,23)).then(a=>a.promises.stat(d)),g=JSON.parse(e);h.push({file:a,createdAt:new Date(g.createdAt||f.mtime),size:f.size})}catch(b){console.warn(`Failed to read session ${a}:`,b)}h.sort((a,b)=>b.createdAt.getTime()-a.createdAt.getTime());let i=[];if(a.olderThan){let b=new Date(a.olderThan);i.push(...h.filter(a=>a.createdAt<b))}else a.options?.keepRecentSessions?i.push(...h.slice(a.options.keepRecentSessions)):i.push(...h);for(let a of i)try{let c=(0,w.join)(b,a.file);await (0,v.unlink)(c),d++,e+=a.size,f.push(`Session: ${a.file.replace(".json","")}`)}catch(b){console.warn(`Failed to delete session ${a.file}:`,b)}return{deletedCount:d,dataFreed:e,clearedData:f}}async function C(a){let b=[],c=!1;try{let d=(0,x.cQ)();return await d.initialize(),a.options?.clearSensitiveData&&(await d.clearSensitiveData(),b.push("API Keys and sensitive settings"),c=!0),a.options?.clearToolHistory&&(await D(),b.push("Tool execution history"),c=!0),{cleared:c,clearedData:b}}catch(a){return console.error("Failed to cleanup settings:",a),{cleared:!1,clearedData:[]}}}async function D(){let a=(0,w.join)(process.cwd(),"data","sessions");try{for(let b of(await (0,v.access)(a),(await (0,v.readdir)(a)).filter(a=>a.endsWith(".json"))))try{let c=(0,w.join)(a,b),d=await (0,v.readFile)(c,"utf-8"),e=JSON.parse(d);e.messages&&(e.messages=e.messages.map(a=>(a.toolCalls&&(a.toolCalls=a.toolCalls.map(a=>({...a,result:void 0,executionTime:void 0,error:void 0}))),a)),await (0,v.writeFile)(c,JSON.stringify(e,null,2)))}catch(a){console.warn(`Failed to clean tool history from ${b}:`,a)}}catch(a){console.warn("Failed to clear tool execution history:",a)}}async function E(){try{let a=(0,w.join)(process.cwd(),"data"),b=(0,w.join)(a,"last-cleanup.json"),c={timestamp:new Date().toISOString(),type:"privacy-cleanup"};await (0,v.writeFile)(b,JSON.stringify(c,null,2))}catch(a){console.warn("Failed to record cleanup timestamp:",a)}}async function F(){let a,b=0,d=0,e=0,f=0,g=0,h=(0,w.join)(process.cwd(),"data","sessions");try{await (0,v.access)(h);let a=(await (0,v.readdir)(h)).filter(a=>a.endsWith(".json"));for(let f of(b=a.length,a))try{let a=(0,w.join)(h,f),b=await Promise.resolve().then(c.t.bind(c,9021,23)).then(b=>b.promises.stat(a)),g=await (0,v.readFile)(a,"utf-8"),i=JSON.parse(g);e+=b.size,d+=i.messages?.length||0}catch(a){console.warn(`Failed to analyze session ${f}:`,a)}}catch{}let i=(0,w.join)(process.cwd(),"data","settings");try{await (0,v.access)(i);let a=(0,w.join)(i,"settings.json"),b=await Promise.resolve().then(c.t.bind(c,9021,23)).then(b=>b.promises.stat(a)),d=await (0,v.readFile)(a,"utf-8"),e=JSON.parse(d);f=b.size,e.llmProviders&&(g=e.llmProviders.filter(a=>a.apiKey).length)}catch{}try{let b=(0,w.join)(process.cwd(),"data","last-cleanup.json"),c=await (0,v.readFile)(b,"utf-8");a=JSON.parse(c).timestamp}catch{}let j=[];if(b>50&&j.push("Consider cleaning up old chat sessions to free up space"),d>1e3&&j.push("Large number of messages stored - consider archiving old conversations"),g>0&&j.push("API keys are encrypted and stored securely"),a){let b=Math.floor((Date.now()-new Date(a).getTime())/864e5);b>30&&j.push(`Last cleanup was ${b} days ago - consider running another cleanup`)}else j.push("No previous cleanup detected - consider running a privacy cleanup");return{totalSessions:b,totalMessages:d,encryptedDataCount:g,lastCleanup:a,recommendations:j,dataBreakdown:{sessionData:e,settingsData:f,totalSize:e+f}}}let G=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/privacy/cleanup/route",pathname:"/api/privacy/cleanup",filename:"route",bundlePath:"app/api/privacy/cleanup/route"},distDir:".next",projectDir:"",resolvedPagePath:"/Users/onebird/github/mcp-chat-client/app/api/privacy/cleanup/route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:H,workUnitAsyncStorage:I,serverHooks:J}=G;function K(){return(0,g.patchFetch)({workAsyncStorage:H,workUnitAsyncStorage:I})}async function L(a,b,c){var d;let e="/api/privacy/cleanup/route";"/index"===e&&(e="/");let g=await G.prepare(a,b,{srcPage:e,multiZoneDraftMode:"false"});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,D=(0,j.normalizeAppPath)(e),E=!!(y.dynamicRoutes[D]||y.routes[C]);if(E&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let F=null;!E||G.isDev||x||(F="/index"===(F=C)?"/":F);let H=!0===G.isDev||!E,I=E&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{dynamicIO:!!w.experimental.dynamicIO,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>G.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>G.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!E)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await G.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})},z),b}},l=await G.handleResponse({req:a,nextConfig:w,cacheKey:F,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!E)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&E||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(L||b instanceof s.NoFallbackError||await G.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})}),E)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},3033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:a=>{"use strict";a.exports=require("path")},4870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5511:a=>{"use strict";a.exports=require("crypto")},6439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},6487:()=>{},8335:()=>{},9021:a=>{"use strict";a.exports=require("fs")},9294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9748:a=>{"use strict";a.exports=require("fs/promises")},9985:(a,b,c)=>{"use strict";c.d(b,{PO:()=>g,m_:()=>f,yI:()=>e}),c(2190);class d extends Error{constructor(a,b=500,c=!0){super(a),this.statusCode=b,this.isOperational=c,Error.captureStackTrace(this,this.constructor)}}class e extends d{constructor(a){super(a,400)}}class f extends d{constructor(a="Resource not found"){super(a,404)}}class g extends d{constructor(a="Internal server error"){super(a,500)}}}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[985,55,690],()=>b(b.s=2277));module.exports=c})();
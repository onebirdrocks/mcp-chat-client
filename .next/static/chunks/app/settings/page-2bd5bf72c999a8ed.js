(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{2424:(e,r,a)=>{"use strict";a.d(r,{default:()=>s});var d=a(5155),t=a(2115);function s(e){let{language:r="en"}=e,[a,s]=(0,t.useState)([]),[n,l]=(0,t.useState)({}),[o,i]=(0,t.useState)(!0),[c,b]=(0,t.useState)(!1),[g,u]=(0,t.useState)(!1),[m,p]=(0,t.useState)(null),[y,x]=(0,t.useState)({name:"openai",enabled:!0,models:[]}),h="zh"===r?{title:"LLM 提供商管理",addProvider:"添加提供商",providerName:"提供商名称",apiKey:"API 密钥",baseUrl:"基础 URL",enabled:"启用",disabled:"禁用",connected:"已连接",disconnected:"未连接",error:"错误",testing:"测试中",testConnection:"测试连接",save:"保存",cancel:"取消",edit:"编辑",delete:"删除",enable:"启用",disable:"禁用",status:"状态",models:"模型",lastTested:"最后测试",noModels:"无可用模型",toolCalling:"支持工具调用",maxTokens:"最大令牌数",loading:"加载中...",saving:"保存中...",testingConnection:"测试连接中...",connectionSuccess:"连接成功",connectionFailed:"连接失败",providerAdded:"提供商已添加",providerUpdated:"提供商已更新",providerDeleted:"提供商已删除",confirmDelete:"确定要删除此提供商吗？",apiKeyPlaceholder:"输入 API 密钥",baseUrlPlaceholder:"可选，留空使用默认值",selectProvider:"选择提供商类型",openai:"OpenAI",deepseek:"DeepSeek",openrouter:"OpenRouter",note:"注意：API 密钥将安全加密存储在服务器上，从不暴露给客户端。",maskedKey:"密钥已加密存储",enterNewKey:"输入新密钥以更新",keepExisting:"保持现有密钥"}:{title:"LLM Provider Management",addProvider:"Add Provider",providerName:"Provider Name",apiKey:"API Key",baseUrl:"Base URL",enabled:"Enabled",disabled:"Disabled",connected:"Connected",disconnected:"Disconnected",error:"Error",testing:"Testing",testConnection:"Test Connection",save:"Save",cancel:"Cancel",edit:"Edit",delete:"Delete",enable:"Enable",disable:"Disable",status:"Status",models:"Models",lastTested:"Last Tested",noModels:"No models available",toolCalling:"Supports Tool Calling",maxTokens:"Max Tokens",loading:"Loading...",saving:"Saving...",testingConnection:"Testing connection...",connectionSuccess:"Connection successful",connectionFailed:"Connection failed",providerAdded:"Provider added",providerUpdated:"Provider updated",providerDeleted:"Provider deleted",confirmDelete:"Are you sure you want to delete this provider?",apiKeyPlaceholder:"Enter API key",baseUrlPlaceholder:"Optional, leave empty for default",selectProvider:"Select provider type",openai:"OpenAI",deepseek:"DeepSeek",openrouter:"OpenRouter",note:"Note: API keys are securely encrypted and stored on the server, never exposed to the client.",maskedKey:"Key is encrypted and stored",enterNewKey:"Enter new key to update",keepExisting:"Keep existing key"};(0,t.useEffect)(()=>{v()},[]);let v=async()=>{try{i(!0);let e=await fetch("/api/settings"),r=await e.json();if(r.success){s(r.data.llmProviders||[]);let e={};for(let a of r.data.llmProviders||[])e[a.id]={id:a.id,status:a.enabled?"disconnected":"disabled",models:a.models||[]};l(e)}}catch(e){console.error("Failed to load providers:",e)}finally{i(!1)}},k=async e=>{let r=a.find(r=>r.id===e);if(r){l(r=>({...r,[e]:{...r[e],status:"testing"}}));try{let d=await fetch("/api/settings/test-connection",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:r.name,providerId:e})}),t=await d.json();if(l(r=>{var a;return{...r,[e]:{...r[e],status:t.success?"connected":"error",error:t.error,models:null==(a=t.models)?void 0:a.map(e=>({id:e.id,name:e.name,displayName:e.name,supportsToolCalling:e.supportsToolCalling,maxTokens:4096})),lastTested:t.timestamp}}}),t.success&&t.models){let r=a.map(r=>r.id===e?{...r,models:t.models.map(e=>({id:e.id,name:e.name,displayName:e.name,supportsToolCalling:e.supportsToolCalling,maxTokens:4096}))}:r);s(r),await f(r)}}catch(r){console.error("Connection test failed:",r),l(r=>({...r,[e]:{...r[e],status:"error",error:"Connection test failed"}}))}}},f=async e=>{try{b(!0);let r=await fetch("/api/settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({llmProviders:e})}),a=await r.json();if(!a.success)throw Error(a.error||"Failed to save providers");return!0}catch(e){return console.error("Failed to save providers:",e),!1}finally{b(!1)}},j=async()=>{var e;if(!y.name||!y.apiKey)return;let r={id:"".concat(y.name,"-").concat(Date.now()),name:y.name,apiKey:y.apiKey,baseUrl:y.baseUrl||P(y.name),models:[],enabled:null==(e=y.enabled)||e},d=[...a,r];await f(d)&&(s(d),l(e=>({...e,[r.id]:{id:r.id,status:r.enabled?"disconnected":"disabled",models:[]}})),u(!1),x({name:"openai",enabled:!0,models:[]}),r.enabled&&setTimeout(()=>k(r.id),500))},N=async(e,r)=>{let d=a.map(a=>a.id===e?{...a,...r}:a);await f(d)&&(s(d),p(null),"enabled"in r&&l(a=>({...a,[e]:{...a[e],status:r.enabled?"disconnected":"disabled"}})))},w=async e=>{if(!confirm(h.confirmDelete))return;let r=a.filter(r=>r.id!==e);await f(r)&&(s(r),l(r=>{let a={...r};return delete a[e],a}))},C=async e=>{let r=a.find(r=>r.id===e);r&&await N(e,{enabled:!r.enabled})},P=e=>{switch(e){case"openai":return"https://api.openai.com/v1";case"deepseek":return"https://api.deepseek.com/v1";case"openrouter":return"https://openrouter.ai/api/v1";default:return""}};return o?(0,d.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,d.jsx)("div",{className:"text-gray-500 dark:text-gray-400",children:h.loading})}):(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("h2",{className:"text-xl font-semibold",children:h.title}),(0,d.jsx)("button",{onClick:()=>u(!0),className:"inline-flex items-center justify-center rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 transition-colors",disabled:c,children:h.addProvider})]}),(0,d.jsx)("div",{className:"text-sm text-gray-600 bg-gray-50 p-4 rounded-lg dark:text-gray-400 dark:bg-gray-700",children:(0,d.jsx)("p",{children:h.note})}),(0,d.jsx)("div",{className:"space-y-4",children:a.map(e=>{let r=n[e.id],t=m===e.id;return(0,d.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 dark:bg-gray-800 dark:border-gray-700",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsx)("div",{className:"w-3 h-3 rounded-full ".concat((e=>{switch(e){case"connected":return"bg-green-500";case"testing":return"bg-yellow-500 animate-pulse";case"error":return"bg-red-500";case"disabled":return"bg-gray-400";default:return"bg-gray-500"}})((null==r?void 0:r.status)||"disconnected"))}),(0,d.jsx)("h3",{className:"font-medium",children:e.name}),(0,d.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:(e=>{switch(e){case"connected":return h.connected;case"testing":return h.testing;case"error":return h.error;case"disabled":return h.disabled;default:return h.disconnected}})((null==r?void 0:r.status)||"disconnected")})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("button",{onClick:()=>k(e.id),disabled:(null==r?void 0:r.status)==="testing"||!e.enabled,className:"text-sm px-3 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 disabled:opacity-50 border border-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600",children:(null==r?void 0:r.status)==="testing"?h.testingConnection:h.testConnection}),(0,d.jsx)("button",{onClick:()=>p(t?null:e.id),className:"text-sm px-3 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 border border-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600",children:t?h.cancel:h.edit}),(0,d.jsx)("button",{onClick:()=>C(e.id),className:"text-sm px-3 py-1 rounded ".concat(e.enabled?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"),children:e.enabled?h.disable:h.enable}),(0,d.jsx)("button",{onClick:()=>w(e.id),className:"text-sm px-3 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200",children:h.delete})]})]}),t&&(0,d.jsxs)("div",{className:"space-y-3 mb-4 p-3 bg-gray-50 rounded dark:bg-gray-700",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:h.apiKey}),(0,d.jsx)("input",{type:"password",placeholder:e.apiKey.includes("*")?h.enterNewKey:h.apiKeyPlaceholder,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:border-blue-400",onChange:r=>{s(a.map(a=>a.id===e.id?{...a,apiKey:r.target.value}:a))}}),e.apiKey.includes("*")&&(0,d.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:h.maskedKey})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:h.baseUrl}),(0,d.jsx)("input",{type:"url",value:e.baseUrl||"",placeholder:h.baseUrlPlaceholder,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:border-blue-400",onChange:r=>{s(a.map(a=>a.id===e.id?{...a,baseUrl:r.target.value}:a))}})]}),(0,d.jsxs)("div",{className:"flex space-x-2",children:[(0,d.jsx)("button",{onClick:()=>N(e.id,a.find(r=>r.id===e.id)),disabled:c,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:c?h.saving:h.save}),(0,d.jsx)("button",{onClick:()=>{p(null),v()},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 border border-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600",children:h.cancel})]})]}),(null==r?void 0:r.error)&&(0,d.jsx)("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded mb-3",children:r.error}),(null==r?void 0:r.lastTested)&&(0,d.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:[h.lastTested,": ",new Date(r.lastTested).toLocaleString()]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h4",{className:"text-sm font-medium mb-2",children:h.models}),(null==r?void 0:r.models)&&r.models.length>0?(0,d.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:r.models.map(e=>{var r;return(0,d.jsxs)("div",{className:"text-sm p-2 bg-gray-50 rounded dark:bg-gray-700",children:[(0,d.jsx)("div",{className:"font-medium",children:e.displayName}),(0,d.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.supportsToolCalling&&"".concat(h.toolCalling," • "),h.maxTokens,": ",(null==(r=e.maxTokens)?void 0:r.toLocaleString())||"N/A"]})]},e.id)})}):(0,d.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:h.noModels})]})]},e.id)})}),g&&(0,d.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 dark:bg-gray-800 dark:border-gray-700",children:[(0,d.jsx)("h3",{className:"font-medium mb-4",children:h.addProvider}),(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:h.providerName}),(0,d.jsxs)("select",{value:y.name,onChange:e=>x(r=>({...r,name:e.target.value,baseUrl:P(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:border-blue-400",children:[(0,d.jsx)("option",{value:"openai",children:h.openai}),(0,d.jsx)("option",{value:"deepseek",children:h.deepseek}),(0,d.jsx)("option",{value:"openrouter",children:h.openrouter})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:h.apiKey}),(0,d.jsx)("input",{type:"password",value:y.apiKey||"",placeholder:h.apiKeyPlaceholder,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:border-blue-400",onChange:e=>x(r=>({...r,apiKey:e.target.value}))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-1",children:h.baseUrl}),(0,d.jsx)("input",{type:"url",value:y.baseUrl||"",placeholder:h.baseUrlPlaceholder,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:border-blue-400",onChange:e=>x(r=>({...r,baseUrl:e.target.value}))})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("input",{type:"checkbox",id:"enabled",checked:y.enabled,onChange:e=>x(r=>({...r,enabled:e.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700"}),(0,d.jsx)("label",{htmlFor:"enabled",className:"text-sm",children:h.enabled})]}),(0,d.jsxs)("div",{className:"flex space-x-2",children:[(0,d.jsx)("button",{onClick:j,disabled:!y.name||!y.apiKey||c,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:c?h.saving:h.save}),(0,d.jsx)("button",{onClick:()=>{u(!1),x({name:"openai",enabled:!0,models:[]})},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 border border-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600",children:h.cancel})]})]})]})]})}},9306:(e,r,a)=>{Promise.resolve().then(a.bind(a,2424)),Promise.resolve().then(a.bind(a,4649)),Promise.resolve().then(a.bind(a,2358)),Promise.resolve().then(a.bind(a,5516)),Promise.resolve().then(a.bind(a,7274))}},e=>{e.O(0,[977,441,964,358],()=>e(e.s=9306)),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{3521:(e,r,s)=>{"use strict";s.d(r,{default:()=>A});var t=s(5155),a=s(2115);function n(e){let{language:r="en"}=e,[s,n]=(0,a.useState)([]),[o,i]=(0,a.useState)({}),[l,d]=(0,a.useState)(!0),[c,m]=(0,a.useState)(!1),[u,g]=(0,a.useState)(!1),[h,p]=(0,a.useState)(null),[x,b]=(0,a.useState)(null),[v,y]=(0,a.useState)(!1),[f,j]=(0,a.useState)({name:"openai",apiKey:"",enabled:!0}),[k,N]=(0,a.useState)(null),w="zh"===r?{title:"LLM 提供商管理",addProvider:"添加提供商",providerName:"提供商名称",apiKey:"API 密钥",baseUrl:"基础 URL",enabled:"启用",disabled:"禁用",connected:"已连接",disconnected:"未连接",error:"错误",testing:"测试中",testConnection:"测试连接",testAll:"测试所有连接",save:"保存",cancel:"取消",edit:"编辑",delete:"删除",enable:"启用",disable:"禁用",status:"状态",models:"模型",lastTested:"最后测试",latency:"延迟",noModels:"无可用模型",toolCalling:"支持工具调用",maxTokens:"最大令牌数",loading:"加载中...",saving:"保存中...",testingConnection:"测试连接中...",connectionSuccess:"连接成功",connectionFailed:"连接失败",providerAdded:"提供商已添加",providerUpdated:"提供商已更新",providerDeleted:"提供商已删除",confirmDelete:"确定要删除此提供商吗？",apiKeyPlaceholder:"输入 API 密钥",baseUrlPlaceholder:"可选，留空使用默认值",selectProvider:"选择提供商类型",openai:"OpenAI",deepseek:"DeepSeek",openrouter:"OpenRouter",note:"注意：API 密钥将安全加密存储在服务器上，从不暴露给客户端。",securityNote:"安全提示：所有 API 密钥都使用 AES 加密存储，仅在服务器端使用，从不发送到客户端。",maskedKey:"密钥已加密存储",enterNewKey:"输入新密钥以更新",keepExisting:"保持现有密钥",providerOverview:"提供商概览",availableProviders:"可用提供商",configuredProviders:"已配置提供商",totalModels:"总模型数",toolSupportedModels:"支持工具调用的模型",refreshStatus:"刷新状态",viewDetails:"查看详情",hideDetails:"隐藏详情",modelDetails:"模型详情",providerDetails:"提供商详情",connectionDetails:"连接详情",ms:"毫秒",never:"从未",unknown:"未知",required:"必填",optional:"可选",validationError:"验证错误",networkError:"网络错误",authError:"认证错误",serverError:"服务器错误",retryConnection:"重试连接",autoTest:"自动测试",manualTest:"手动测试"}:{title:"LLM Provider Management",addProvider:"Add Provider",providerName:"Provider Name",apiKey:"API Key",baseUrl:"Base URL",enabled:"Enabled",disabled:"Disabled",connected:"Connected",disconnected:"Disconnected",error:"Error",testing:"Testing",testConnection:"Test Connection",testAll:"Test All Connections",save:"Save",cancel:"Cancel",edit:"Edit",delete:"Delete",enable:"Enable",disable:"Disable",status:"Status",models:"Models",lastTested:"Last Tested",latency:"Latency",noModels:"No models available",toolCalling:"Supports Tool Calling",maxTokens:"Max Tokens",loading:"Loading...",saving:"Saving...",testingConnection:"Testing connection...",connectionSuccess:"Connection successful",connectionFailed:"Connection failed",providerAdded:"Provider added",providerUpdated:"Provider updated",providerDeleted:"Provider deleted",confirmDelete:"Are you sure you want to delete this provider?",apiKeyPlaceholder:"Enter API key",baseUrlPlaceholder:"Optional, leave empty for default",selectProvider:"Select provider type",openai:"OpenAI",deepseek:"DeepSeek",openrouter:"OpenRouter",note:"Note: API keys are securely encrypted and stored on the server, never exposed to the client.",securityNote:"Security: All API keys are encrypted with AES and stored server-side only, never sent to the client.",maskedKey:"Key is encrypted and stored",enterNewKey:"Enter new key to update",keepExisting:"Keep existing key",providerOverview:"Provider Overview",availableProviders:"Available Providers",configuredProviders:"Configured Providers",totalModels:"Total Models",toolSupportedModels:"Tool-Calling Models",refreshStatus:"Refresh Status",viewDetails:"View Details",hideDetails:"Hide Details",modelDetails:"Model Details",providerDetails:"Provider Details",connectionDetails:"Connection Details",ms:"ms",never:"Never",unknown:"Unknown",required:"Required",optional:"Optional",validationError:"Validation Error",networkError:"Network Error",authError:"Authentication Error",serverError:"Server Error",retryConnection:"Retry Connection",autoTest:"Auto Test",manualTest:"Manual Test"};(0,a.useEffect)(()=>{C()},[]),(0,a.useEffect)(()=>{if(k){let e=setTimeout(()=>{N(null)},5e3);return()=>clearTimeout(e)}},[k]);let S=(0,a.useCallback)((e,r)=>{N({type:e,message:r})},[]),C=async()=>{try{d(!0);let e=await fetch("/api/settings"),r=await e.json();if(r.success){n(r.data.llmProviders||[]);let e={};for(let s of r.data.llmProviders||[])e[s.id]={id:s.id,status:s.enabled?"disconnected":"disabled",models:s.models||[]};i(e)}}catch(e){console.error("Failed to load providers:",e)}finally{d(!1)}},P=async function(e){let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1],t=s.find(r=>r.id===e);if(!t)return;i(r=>({...r,[e]:{...r[e],status:"testing"}}));let a=Date.now();try{let o=await fetch("/api/settings/test-connection",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:t.name,providerId:e})}),l=await o.json(),d=Date.now()-a;if(i(r=>{var s;return{...r,[e]:{...r[e],status:l.success?"connected":"error",error:l.error,models:null==(s=l.models)?void 0:s.map(e=>({id:e.id,name:e.name,displayName:e.name,supportsToolCalling:e.supportsToolCalling,maxTokens:4096})),lastTested:l.timestamp,latency:l.latency||d}}}),l.success&&l.models){let a=s.map(r=>r.id===e?{...r,models:l.models.map(e=>({id:e.id,name:e.name,displayName:e.name,supportsToolCalling:e.supportsToolCalling,maxTokens:4096}))}:r);n(a),await A(a),r&&S("success","".concat(w.connectionSuccess,": ").concat(t.name))}else r&&S("error","".concat(w.connectionFailed,": ").concat(t.name," - ").concat(l.error))}catch(n){console.error("Connection test failed:",n);let s=Date.now()-a;i(r=>({...r,[e]:{...r[e],status:"error",error:"Connection test failed",latency:s}})),r&&S("error","".concat(w.connectionFailed,": ").concat(t.name))}},T=async()=>{y(!0);let e=s.filter(e=>e.enabled&&e.apiKey&&!e.apiKey.includes("*"));S("info","Testing ".concat(e.length," providers..."));try{let r=e.map(e=>P(e.id,!1));await Promise.allSettled(r);let s=Object.values(o).filter(e=>"connected"===e.status).length;S("success","Testing complete: ".concat(s,"/").concat(e.length," providers connected"))}catch(e){S("error","Failed to test all connections")}finally{y(!1)}},A=async e=>{try{m(!0);let r=await fetch("/api/settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({llmProviders:e})}),s=await r.json();if(!s.success)throw Error(s.error||"Failed to save providers");return!0}catch(e){return console.error("Failed to save providers:",e),!1}finally{m(!1)}},L=async()=>{if(!f.name||!f.apiKey)return void S("error","Provider name and API key are required");if(!E(f.name,f.apiKey))return void S("error","Invalid API key format for selected provider");m(!0);try{let e={id:"".concat(f.name,"-").concat(Date.now()),name:f.name,apiKey:f.apiKey,baseUrl:f.baseUrl||F(f.name),models:[],enabled:f.enabled},r=[...s,e];await A(r)?(n(r),i(r=>({...r,[e.id]:{id:e.id,status:e.enabled?"disconnected":"disabled",models:[]}})),g(!1),j({name:"openai",apiKey:"",enabled:!0}),S("success",w.providerAdded),e.enabled&&setTimeout(()=>P(e.id),500)):S("error","Failed to save provider")}catch(e){console.error("Failed to add provider:",e),S("error","Failed to add provider")}finally{m(!1)}},E=(e,r)=>{if(!r||r.length<10)return!1;switch(e){case"openai":case"deepseek":return r.startsWith("sk-")&&r.length>20;case"openrouter":return r.startsWith("sk-or-")&&r.length>30;default:return r.length>10}},D=async(e,r)=>{let t=s.map(s=>s.id===e?{...s,...r}:s);await A(t)&&(n(t),p(null),"enabled"in r&&i(s=>({...s,[e]:{...s[e],status:r.enabled?"disconnected":"disabled"}})))},M=async e=>{if(!confirm(w.confirmDelete))return;let r=s.filter(r=>r.id!==e);await A(r)&&(n(r),i(r=>{let s={...r};return delete s[e],s}))},I=async e=>{let r=s.find(r=>r.id===e);r&&await D(e,{enabled:!r.enabled})},F=e=>{switch(e){case"openai":return"https://api.openai.com/v1";case"deepseek":return"https://api.deepseek.com/v1";case"openrouter":return"https://openrouter.ai/api/v1";default:return""}},K=e=>{switch(e){case"connected":return w.connected;case"testing":return w.testing;case"error":return w.error;case"disabled":return w.disabled;default:return w.disconnected}};if(l)return(0,t.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,t.jsx)("div",{className:"ml-3 text-gray-500 dark:text-gray-400",children:w.loading})]});let O=s.length,U=s.filter(e=>e.enabled).length,R=Object.values(o).filter(e=>"connected"===e.status).length,J=Object.values(o).reduce((e,r)=>{var s;return e+((null==(s=r.models)?void 0:s.length)||0)},0),z=Object.values(o).reduce((e,r)=>{var s;return e+((null==(s=r.models)?void 0:s.filter(e=>e.supportsToolCalling).length)||0)},0);return(0,t.jsxs)("div",{className:"space-y-6",children:[k&&(0,t.jsx)("div",{className:"p-4 rounded-lg border-l-4 ".concat("success"===k.type?"bg-green-50 border-green-400 text-green-700 dark:bg-green-900/20 dark:text-green-400":"error"===k.type?"bg-red-50 border-red-400 text-red-700 dark:bg-red-900/20 dark:text-red-400":"bg-blue-50 border-blue-400 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400"),children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:k.message}),(0,t.jsx)("button",{onClick:()=>N(null),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:"\xd7"})]})}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:w.title}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)("button",{onClick:T,disabled:v||0===U,className:"inline-flex items-center justify-center rounded-md bg-gray-100 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-200 transition-colors disabled:opacity-50 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",children:v?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600 mr-2"}),w.testing]}):w.testAll}),(0,t.jsx)("button",{onClick:()=>g(!0),className:"inline-flex items-center justify-center rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 transition-colors",disabled:c,children:w.addProvider})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 dark:bg-gray-800 dark:border-gray-700",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:O}),(0,t.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:w.configuredProviders})]}),(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 dark:bg-gray-800 dark:border-gray-700",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-green-600",children:R}),(0,t.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:w.connected})]}),(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 dark:bg-gray-800 dark:border-gray-700",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:J}),(0,t.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:w.totalModels})]}),(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 dark:bg-gray-800 dark:border-gray-700",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:z}),(0,t.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:w.toolSupportedModels})]})]}),(0,t.jsx)("div",{className:"text-sm text-gray-600 bg-gray-50 p-4 rounded-lg border-l-4 border-blue-400 dark:text-gray-400 dark:bg-gray-700",children:(0,t.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,t.jsx)("div",{className:"flex-shrink-0 w-5 h-5 text-blue-500 mt-0.5",children:"\uD83D\uDD12"}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-medium mb-1",children:[w.note.split(":")[0],":"]}),(0,t.jsx)("p",{children:w.securityNote})]})]})}),(0,t.jsxs)("div",{className:"space-y-4",children:[s.map(e=>{var r,a;let i=o[e.id],l=h===e.id,d=x===e.id;return(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg dark:bg-gray-800 dark:border-gray-700",children:[(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-3 h-3 rounded-full ".concat((e=>{switch(e){case"connected":return"bg-green-500";case"testing":return"bg-yellow-500 animate-pulse";case"error":return"bg-red-500";case"disabled":return"bg-gray-400";default:return"bg-gray-500"}})((null==i?void 0:i.status)||"disconnected"))}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium capitalize",children:e.name}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400",children:[(0,t.jsx)("span",{children:K((null==i?void 0:i.status)||"disconnected")}),(null==i?void 0:i.latency)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:"•"}),(0,t.jsxs)("span",{children:[i.latency,w.ms]})]}),(null==i?void 0:i.models)&&i.models.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:"•"}),(0,t.jsxs)("span",{children:[i.models.length," ",w.models.toLowerCase()]})]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("button",{onClick:()=>b(d?null:e.id),className:"text-sm px-3 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 border border-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600",children:d?w.hideDetails:w.viewDetails}),(0,t.jsx)("button",{onClick:()=>P(e.id),disabled:(null==i?void 0:i.status)==="testing"||!e.enabled,className:"text-sm px-3 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 disabled:opacity-50 border border-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600",children:(null==i?void 0:i.status)==="testing"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-gray-600 mr-1 inline-block"}),w.testing]}):w.testConnection}),(0,t.jsx)("button",{onClick:()=>p(l?null:e.id),className:"text-sm px-3 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 border border-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600",children:l?w.cancel:w.edit}),(0,t.jsx)("button",{onClick:()=>I(e.id),className:"text-sm px-3 py-1 rounded transition-colors ".concat(e.enabled?"bg-red-100 text-red-700 hover:bg-red-200 dark:bg-red-900/20 dark:text-red-400 dark:hover:bg-red-900/30":"bg-green-100 text-green-700 hover:bg-green-200 dark:bg-green-900/20 dark:text-green-400 dark:hover:bg-green-900/30"),children:e.enabled?w.disable:w.enable}),(0,t.jsx)("button",{onClick:()=>M(e.id),className:"text-sm px-3 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200 dark:bg-red-900/20 dark:text-red-400 dark:hover:bg-red-900/30",children:w.delete})]})]}),(null==i?void 0:i.error)&&(0,t.jsx)("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded mb-3 dark:bg-red-900/20 dark:text-red-400",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{children:"⚠️"}),(0,t.jsx)("span",{children:i.error})]})}),(null==i?void 0:i.lastTested)&&(0,t.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[w.lastTested,": ",new Date(i.lastTested).toLocaleString()]})]}),d&&(0,t.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4 bg-gray-50 dark:bg-gray-700/50",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium mb-3",children:w.providerDetails}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("span",{className:"text-gray-500 dark:text-gray-400",children:[w.providerName,":"]}),(0,t.jsx)("span",{className:"capitalize",children:e.name})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("span",{className:"text-gray-500 dark:text-gray-400",children:[w.baseUrl,":"]}),(0,t.jsx)("span",{className:"truncate ml-2",children:e.baseUrl||w.unknown})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("span",{className:"text-gray-500 dark:text-gray-400",children:[w.apiKey,":"]}),(0,t.jsx)("span",{className:"font-mono text-xs",children:e.apiKey.includes("*")?w.maskedKey:"••••••••"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("span",{className:"text-gray-500 dark:text-gray-400",children:[w.status,":"]}),(0,t.jsx)("span",{className:"font-medium ".concat((null==i?void 0:i.status)==="connected"?"text-green-600":(null==i?void 0:i.status)==="error"?"text-red-600":(null==i?void 0:i.status)==="testing"?"text-yellow-600":"text-gray-600"),children:K((null==i?void 0:i.status)||"disconnected")})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium mb-3",children:w.connectionDetails}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("span",{className:"text-gray-500 dark:text-gray-400",children:[w.lastTested,":"]}),(0,t.jsx)("span",{children:(null==i?void 0:i.lastTested)?new Date(i.lastTested).toLocaleString():w.never})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("span",{className:"text-gray-500 dark:text-gray-400",children:[w.latency,":"]}),(0,t.jsx)("span",{children:(null==i?void 0:i.latency)?"".concat(i.latency).concat(w.ms):w.unknown})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("span",{className:"text-gray-500 dark:text-gray-400",children:[w.totalModels,":"]}),(0,t.jsx)("span",{children:(null==i||null==(r=i.models)?void 0:r.length)||0})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("span",{className:"text-gray-500 dark:text-gray-400",children:[w.toolSupportedModels,":"]}),(0,t.jsx)("span",{children:(null==i||null==(a=i.models)?void 0:a.filter(e=>e.supportsToolCalling).length)||0})]})]})]})]}),(null==i?void 0:i.models)&&i.models.length>0&&(0,t.jsxs)("div",{className:"mt-6",children:[(0,t.jsx)("h4",{className:"text-sm font-medium mb-3",children:w.modelDetails}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:i.models.map(e=>{var r;return(0,t.jsxs)("div",{className:"text-sm p-3 bg-white rounded border dark:bg-gray-800 dark:border-gray-600",children:[(0,t.jsx)("div",{className:"font-medium mb-1",children:e.displayName}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 space-y-1",children:[(0,t.jsxs)("div",{children:["ID: ",e.id]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"w-2 h-2 rounded-full ".concat(e.supportsToolCalling?"bg-green-500":"bg-gray-400")}),(0,t.jsx)("span",{children:e.supportsToolCalling?w.toolCalling:"No tool calling"})]}),(0,t.jsxs)("div",{children:[w.maxTokens,": ",(null==(r=e.maxTokens)?void 0:r.toLocaleString())||"N/A"]})]})]},e.id)})})]})]}),l&&(0,t.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4 bg-gray-50 dark:bg-gray-700/50",children:[(0,t.jsxs)("h4",{className:"text-sm font-medium mb-3",children:[w.edit," ",e.name]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{htmlFor:"edit-api-key-".concat(e.id),className:"block text-sm font-medium mb-1",children:[w.apiKey," ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)("input",{id:"edit-api-key-".concat(e.id),type:"password",placeholder:e.apiKey.includes("*")?w.enterNewKey:w.apiKeyPlaceholder,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:border-blue-400",onChange:r=>{n(s.map(s=>s.id===e.id?{...s,apiKey:r.target.value}:s))}}),e.apiKey.includes("*")&&(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:w.maskedKey})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{htmlFor:"edit-base-url-".concat(e.id),className:"block text-sm font-medium mb-1",children:[w.baseUrl," ",(0,t.jsxs)("span",{className:"text-gray-400",children:["(",w.optional,")"]})]}),(0,t.jsx)("input",{id:"edit-base-url-".concat(e.id),type:"url",value:e.baseUrl||"",placeholder:w.baseUrlPlaceholder,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:border-blue-400",onChange:r=>{n(s.map(s=>s.id===e.id?{...s,baseUrl:r.target.value}:s))}})]}),(0,t.jsxs)("div",{className:"flex space-x-2 pt-2",children:[(0,t.jsx)("button",{onClick:()=>D(e.id,s.find(r=>r.id===e.id)),disabled:c,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 transition-colors",children:c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2 inline-block"}),w.saving]}):w.save}),(0,t.jsx)("button",{onClick:()=>{p(null),C()},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 border border-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600 transition-colors",children:w.cancel})]})]})]})]},e.id)}),0===s.length&&(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[(0,t.jsx)("div",{className:"text-4xl mb-4",children:"\uD83E\uDD16"}),(0,t.jsx)("p",{className:"text-lg font-medium mb-2",children:"No providers configured"}),(0,t.jsx)("p",{className:"text-sm",children:"Add your first LLM provider to get started"})]})]}),u&&(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg dark:bg-gray-800 dark:border-gray-700",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,t.jsx)("h3",{className:"font-medium",children:w.addProvider}),(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Configure a new LLM provider for chat sessions"})]}),(0,t.jsxs)("div",{className:"p-4 space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{htmlFor:"provider-name-select",className:"block text-sm font-medium mb-1",children:[w.providerName," ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("select",{id:"provider-name-select",value:f.name,onChange:e=>j(r=>({...r,name:e.target.value,baseUrl:F(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:border-blue-400",children:[(0,t.jsx)("option",{value:"openai",children:w.openai}),(0,t.jsx)("option",{value:"deepseek",children:w.deepseek}),(0,t.jsx)("option",{value:"openrouter",children:w.openrouter})]}),(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Select the LLM provider type"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{htmlFor:"api-key-input",className:"block text-sm font-medium mb-1",children:[w.apiKey," ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)("input",{id:"api-key-input",type:"password",value:f.apiKey,placeholder:w.apiKeyPlaceholder,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:border-blue-400",onChange:e=>j(r=>({...r,apiKey:e.target.value}))}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["openai"===f.name&&"Starts with sk- (e.g., sk-...)","deepseek"===f.name&&"Starts with sk- (e.g., sk-...)","openrouter"===f.name&&"Starts with sk-or- (e.g., sk-or-...)"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{htmlFor:"base-url-input",className:"block text-sm font-medium mb-1",children:[w.baseUrl," ",(0,t.jsxs)("span",{className:"text-gray-400",children:["(",w.optional,")"]})]}),(0,t.jsx)("input",{id:"base-url-input",type:"url",value:f.baseUrl||"",placeholder:w.baseUrlPlaceholder,className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:border-blue-400",onChange:e=>j(r=>({...r,baseUrl:e.target.value}))}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Default: ",F(f.name)]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"enabled-new",checked:f.enabled,onChange:e=>j(r=>({...r,enabled:e.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700"}),(0,t.jsx)("label",{htmlFor:"enabled-new",className:"text-sm",children:w.enabled}),(0,t.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"(Enable immediately after adding)"})]}),f.apiKey&&(0,t.jsx)("div",{className:"text-xs p-2 rounded ".concat(E(f.name,f.apiKey)?"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-400":"bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-400"),children:E(f.name,f.apiKey)?"✓ API key format looks valid":"⚠ API key format may be invalid"}),(0,t.jsxs)("div",{className:"flex space-x-2 pt-2",children:[(0,t.jsx)("button",{onClick:L,disabled:!f.name||!f.apiKey||c||!E(f.name,f.apiKey),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 transition-colors",children:c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2 inline-block"}),w.saving]}):w.save}),(0,t.jsx)("button",{onClick:()=>{g(!1),j({name:"openai",apiKey:"",enabled:!0})},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 border border-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600 transition-colors",children:w.cancel})]})]})]})]})}function o(e){let{language:r="en"}=e,[s,n]=(0,a.useState)({}),[o,i]=(0,a.useState)({}),[l,d]=(0,a.useState)({}),[c,m]=(0,a.useState)(!0),[u,g]=(0,a.useState)(null),[h,p]=(0,a.useState)(null),[x,b]=(0,a.useState)(""),[v,y]=(0,a.useState)(!1),[f,j]=(0,a.useState)({id:"",command:"",args:[],env:{},disabled:!1,timeout:3e4,maxConcurrency:5}),[k,N]=(0,a.useState)(null),w="zh"===r?{mcpServers:"MCP 服务器",serverConfiguration:"MCP 服务器配置",addServer:"添加服务器",editServer:"编辑服务器",deleteServer:"删除服务器",testConnection:"测试连接",enableServer:"启用服务器",disableServer:"禁用服务器",serverStatus:"服务器状态",availableTools:"可用工具",connectionStatus:"连接状态",lastCheck:"最后检查",responseTime:"响应时间",uptime:"运行时间",toolCount:"工具数量",serverDetails:"服务器详情",command:"命令",arguments:"参数",environment:"环境变量",timeout:"超时时间",maxConcurrency:"最大并发",serverId:"服务器ID",save:"保存",cancel:"取消",delete:"删除",edit:"编辑",test:"测试",enable:"启用",disable:"禁用",refresh:"刷新",connected:"已连接",disconnected:"已断开",error:"错误",connecting:"连接中",healthy:"健康",unhealthy:"不健康",unknown:"未知",noServers:"未配置服务器",noTools:"无可用工具",configurationEditor:"配置编辑器",jsonConfiguration:"JSON 配置",invalidJson:"无效的 JSON 格式",serverAdded:"服务器已添加",serverUpdated:"服务器已更新",serverDeleted:"服务器已删除",connectionTested:"连接已测试",errorOccurred:"发生错误",confirmDelete:"确认删除",deleteConfirmation:'确定要删除服务器 "{name}" 吗？此操作无法撤销。',troubleshooting:"故障排除",troubleshootingTips:"故障排除提示",checkCommand:"检查命令路径是否正确",checkArgs:"验证参数格式",checkEnv:"确认环境变量设置",checkPermissions:"检查文件权限",viewLogs:"查看日志",reconnect:"重新连接",ms:"毫秒",seconds:"秒",minutes:"分钟",hours:"小时",days:"天"}:{mcpServers:"MCP Servers",serverConfiguration:"MCP Server Configuration",addServer:"Add Server",editServer:"Edit Server",deleteServer:"Delete Server",testConnection:"Test Connection",enableServer:"Enable Server",disableServer:"Disable Server",serverStatus:"Server Status",availableTools:"Available Tools",connectionStatus:"Connection Status",lastCheck:"Last Check",responseTime:"Response Time",uptime:"Uptime",toolCount:"Tool Count",serverDetails:"Server Details",command:"Command",arguments:"Arguments",environment:"Environment Variables",timeout:"Timeout",maxConcurrency:"Max Concurrency",serverId:"Server ID",save:"Save",cancel:"Cancel",delete:"Delete",edit:"Edit",test:"Test",enable:"Enable",disable:"Disable",refresh:"Refresh",connected:"Connected",disconnected:"Disconnected",error:"Error",connecting:"Connecting",healthy:"Healthy",unhealthy:"Unhealthy",unknown:"Unknown",noServers:"No servers configured",noTools:"No tools available",configurationEditor:"Configuration Editor",jsonConfiguration:"JSON Configuration",invalidJson:"Invalid JSON format",serverAdded:"Server added",serverUpdated:"Server updated",serverDeleted:"Server deleted",connectionTested:"Connection tested",errorOccurred:"An error occurred",confirmDelete:"Confirm Delete",deleteConfirmation:'Are you sure you want to delete server "{name}"? This action cannot be undone.',troubleshooting:"Troubleshooting",troubleshootingTips:"Troubleshooting Tips",checkCommand:"Check if command path is correct",checkArgs:"Verify argument format",checkEnv:"Confirm environment variable settings",checkPermissions:"Check file permissions",viewLogs:"View Logs",reconnect:"Reconnect",ms:"ms",seconds:"seconds",minutes:"minutes",hours:"hours",days:"days"};(0,a.useEffect)(()=>{S(),C(),P()},[]);let S=async()=>{try{m(!0);let e=await fetch("/api/settings/mcp-servers");if(!e.ok)throw Error("HTTP ".concat(e.status,": ").concat(e.statusText));let r=await e.json();n(r.mcpServers||{})}catch(e){console.error("Failed to load MCP servers:",e),g(e instanceof Error?e.message:"Failed to load servers")}finally{m(!1)}},C=async()=>{try{let e=await fetch("/api/settings/mcp-servers/status");if(e.ok){let r=await e.json();i(r)}}catch(e){console.error("Failed to load server statuses:",e)}},P=async()=>{try{let e=await fetch("/api/settings/mcp-servers/tools");if(e.ok){let r=await e.json();d(r)}}catch(e){console.error("Failed to load server tools:",e)}},T=async(e,r)=>{try{let s=await fetch("/api/settings/mcp-servers",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({serverId:e,config:r})});if(!s.ok)throw Error("HTTP ".concat(s.status,": ").concat(s.statusText));await S(),await C(),p(null),y(!1),g(null)}catch(e){console.error("Failed to save server:",e),g(e instanceof Error?e.message:"Failed to save server")}},A=async e=>{if(confirm(w.deleteConfirmation.replace("{name}",e)))try{let r=await fetch("/api/settings/mcp-servers/".concat(e),{method:"DELETE"});if(!r.ok)throw Error("HTTP ".concat(r.status,": ").concat(r.statusText));await S(),await C()}catch(e){console.error("Failed to delete server:",e),g(e instanceof Error?e.message:"Failed to delete server")}},L=async e=>{try{N(e);let r=await fetch("/api/settings/mcp-servers/".concat(e,"/test"),{method:"POST"});if(!r.ok)throw Error("HTTP ".concat(r.status,": ").concat(r.statusText));await r.json(),await C(),await P(),g(null)}catch(e){console.error("Failed to test connection:",e),g(e instanceof Error?e.message:"Connection test failed")}finally{N(null)}},E=async(e,r)=>{let t=s[e];t&&await T(e,{...t,disabled:!r})},D=async()=>{if(h)try{let e=JSON.parse(x);await T(h,e)}catch(e){g(w.invalidJson)}},M=async()=>{if(!f.id||!f.command)return void g("Server ID and command are required");await T(f.id,{command:f.command,args:f.args,env:f.env,disabled:f.disabled,timeout:f.timeout,maxConcurrency:f.maxConcurrency}),j({id:"",command:"",args:[],env:{},disabled:!1,timeout:3e4,maxConcurrency:5})};return c?(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"animate-pulse",children:[(0,t.jsx)("div",{className:"h-4 bg-muted rounded w-1/4 mb-4"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"h-16 bg-muted rounded"}),(0,t.jsx)("div",{className:"h-16 bg-muted rounded"})]})]})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:w.serverConfiguration}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)("button",{onClick:C,className:"inline-flex items-center justify-center rounded-md border border-input bg-background px-3 py-2 text-sm font-medium hover:bg-accent hover:text-accent-foreground transition-colors",children:w.refresh}),(0,t.jsx)("button",{onClick:()=>y(!0),className:"inline-flex items-center justify-center rounded-md bg-primary px-3 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition-colors",children:w.addServer})]})]}),u&&(0,t.jsxs)("div",{className:"bg-destructive/10 border border-destructive/20 text-destructive px-4 py-3 rounded-lg",children:[(0,t.jsx)("p",{className:"text-sm",children:u}),(0,t.jsx)("button",{onClick:()=>g(null),className:"text-xs underline mt-1",children:"Dismiss"})]}),0===Object.keys(s).length?(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:(0,t.jsx)("p",{children:w.noServers})}):(0,t.jsx)("div",{className:"space-y-4",children:Object.entries(s).map(e=>{let[r,a]=e,n=o[r],i=l[r]||[],d=h===r;return(0,t.jsxs)("div",{className:"border rounded-lg p-4 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-3 h-3 rounded-full ".concat((e=>{switch(e){case"connected":case"healthy":return"bg-green-500";case"error":case"unhealthy":return"bg-red-500";default:return"bg-yellow-500"}})((null==n?void 0:n.status)||"unknown"))}),(0,t.jsx)("h4",{className:"font-medium",children:r}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:(e=>{switch(e){case"connected":return w.connected;case"disconnected":return w.disconnected;case"error":return w.error;case"connecting":return w.connecting;case"healthy":return w.healthy;case"unhealthy":return w.unhealthy;default:return w.unknown}})((null==n?void 0:n.status)||"unknown")})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("button",{onClick:()=>L(r),disabled:k===r,className:"text-sm px-3 py-1 border rounded hover:bg-accent transition-colors disabled:opacity-50",children:k===r?"...":w.test}),(0,t.jsx)("button",{onClick:()=>E(r,!!a.disabled),className:"text-sm px-3 py-1 border rounded transition-colors ".concat(a.disabled?"bg-green-50 text-green-700 border-green-200 hover:bg-green-100":"bg-red-50 text-red-700 border-red-200 hover:bg-red-100"),children:a.disabled?w.enable:w.disable}),(0,t.jsx)("button",{onClick:()=>(e=>{let r=s[e];r&&(p(e),b(JSON.stringify({command:r.command,args:r.args||[],env:r.env||{},disabled:r.disabled||!1,timeout:r.timeout||3e4,maxConcurrency:r.maxConcurrency||5},null,2)))})(r),className:"text-sm px-3 py-1 border rounded hover:bg-accent transition-colors",children:w.edit}),(0,t.jsx)("button",{onClick:()=>A(r),className:"text-sm px-3 py-1 border border-red-200 text-red-700 rounded hover:bg-red-50 transition-colors",children:w.delete})]})]}),d?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:w.jsonConfiguration}),(0,t.jsx)("textarea",{value:x,onChange:e=>b(e.target.value),className:"w-full h-64 p-3 border rounded-md font-mono text-sm bg-background",placeholder:"Enter JSON configuration..."})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)("button",{onClick:()=>p(null),className:"px-4 py-2 border rounded-md hover:bg-accent transition-colors",children:w.cancel}),(0,t.jsx)("button",{onClick:D,className:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors",children:w.save})]})]}):(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[(0,t.jsx)("div",{children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"font-medium",children:[w.command,":"]}),(0,t.jsx)("span",{className:"ml-2 font-mono bg-muted px-2 py-1 rounded",children:a.command})]}),a.args&&a.args.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"font-medium",children:[w.arguments,":"]}),(0,t.jsx)("div",{className:"ml-2 space-y-1",children:a.args.map((e,r)=>(0,t.jsx)("div",{className:"font-mono bg-muted px-2 py-1 rounded text-xs",children:e},r))})]}),a.env&&Object.keys(a.env).length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"font-medium",children:[w.environment,":"]}),(0,t.jsx)("div",{className:"ml-2 space-y-1",children:Object.entries(a.env).map(e=>{let[r,s]=e;return(0,t.jsxs)("div",{className:"font-mono bg-muted px-2 py-1 rounded text-xs",children:[r,"=",s]},r)})})]})]})}),(0,t.jsx)("div",{children:n&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"font-medium",children:[w.lastCheck,":"]}),(0,t.jsx)("span",{className:"ml-2",children:new Date(n.lastCheck).toLocaleString()})]}),n.responseTime&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"font-medium",children:[w.responseTime,":"]}),(0,t.jsxs)("span",{className:"ml-2",children:[n.responseTime,w.ms]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"font-medium",children:[w.uptime,":"]}),(0,t.jsx)("span",{className:"ml-2",children:(e=>{if(!e)return"-";let r=Math.floor(e/1e3),s=Math.floor(r/60),t=Math.floor(s/60),a=Math.floor(t/24);return a>0?"".concat(a," ").concat(w.days):t>0?"".concat(t," ").concat(w.hours):s>0?"".concat(s," ").concat(w.minutes):"".concat(r," ").concat(w.seconds)})(n.uptime)})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"font-medium",children:[w.toolCount,":"]}),(0,t.jsx)("span",{className:"ml-2",children:n.toolCount})]})]})})]}),!d&&i.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{className:"font-medium mb-2",children:w.availableTools}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:i.map(e=>(0,t.jsxs)("div",{className:"bg-muted/50 p-2 rounded text-sm",children:[(0,t.jsx)("div",{className:"font-medium",children:e.name.replace("".concat(r,"."),"")}),e.description&&(0,t.jsx)("div",{className:"text-muted-foreground text-xs mt-1",children:e.description})]},e.name))})]}),!d&&(null==n?void 0:n.status)==="unhealthy"&&(0,t.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 p-3 rounded-lg",children:[(0,t.jsx)("h5",{className:"font-medium text-yellow-800 mb-2",children:w.troubleshootingTips}),(0,t.jsxs)("ul",{className:"text-sm text-yellow-700 space-y-1",children:[(0,t.jsxs)("li",{children:["• ",w.checkCommand]}),(0,t.jsxs)("li",{children:["• ",w.checkArgs]}),(0,t.jsxs)("li",{children:["• ",w.checkEnv]}),(0,t.jsxs)("li",{children:["• ",w.checkPermissions]})]}),n.error&&(0,t.jsx)("div",{className:"mt-2 p-2 bg-yellow-100 rounded text-xs font-mono",children:n.error})]})]},r)})}),v&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-background border rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsx)("h3",{className:"text-lg font-medium mb-4",children:w.addServer}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:w.serverId}),(0,t.jsx)("input",{type:"text",value:f.id,onChange:e=>j(r=>({...r,id:e.target.value})),className:"w-full p-2 border rounded-md",placeholder:"e.g., filesystem"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:w.command}),(0,t.jsx)("input",{type:"text",value:f.command,onChange:e=>j(r=>({...r,command:e.target.value})),className:"w-full p-2 border rounded-md",placeholder:"e.g., npx"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:w.arguments}),(0,t.jsx)("textarea",{value:f.args.join("\n"),onChange:e=>j(r=>({...r,args:e.target.value.split("\n").filter(e=>e.trim())})),className:"w-full p-2 border rounded-md h-24",placeholder:"One argument per line"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium mb-1",children:[w.timeout," (ms)"]}),(0,t.jsx)("input",{type:"number",value:f.timeout,onChange:e=>j(r=>({...r,timeout:parseInt(e.target.value)||3e4})),className:"w-full p-2 border rounded-md"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:w.maxConcurrency}),(0,t.jsx)("input",{type:"number",value:f.maxConcurrency,onChange:e=>j(r=>({...r,maxConcurrency:parseInt(e.target.value)||5})),className:"w-full p-2 border rounded-md"})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2 mt-6",children:[(0,t.jsx)("button",{onClick:()=>y(!1),className:"px-4 py-2 border rounded-md hover:bg-accent transition-colors",children:w.cancel}),(0,t.jsx)("button",{onClick:M,className:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors",children:w.save})]})]})})]})}var i=s(3784),l=s(1218),d=s(5453),c=s(6786);let m={llmProviders:[{id:"default-openai",name:"openai",apiKey:"",baseUrl:"https://api.openai.com/v1",models:[{id:"gpt-4o",name:"GPT-4o",supportsToolCalling:!0,maxTokens:128e3},{id:"gpt-4o-mini",name:"GPT-4o Mini",supportsToolCalling:!0,maxTokens:128e3},{id:"gpt-4-turbo",name:"GPT-4 Turbo",supportsToolCalling:!0,maxTokens:128e3},{id:"gpt-4",name:"GPT-4",supportsToolCalling:!0,maxTokens:8192},{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo",supportsToolCalling:!0,maxTokens:16385}],enabled:!1}],mcpServers:[],preferences:{theme:"system",language:"en",autoScroll:!0,soundEnabled:!1,accessibility:{highContrast:!1,reducedMotion:!1,screenReaderAnnouncements:!0,keyboardNavigation:!0,focusVisible:!0,largeText:!1}}},u=()=>Date.now().toString(36)+Math.random().toString(36).substring(2),g="mcp-chat-ui-settings",h=e=>{try{if(!e||"object"!=typeof e)throw Error("Invalid settings object");let r={...e,llmProviders:(e.llmProviders||[]).map(e=>({...e,apiKey:""}))},s=JSON.stringify(r);localStorage.setItem(g,s)}catch(e){throw console.error("Failed to save settings to localStorage:",e),e}},p=()=>{try{let e=localStorage.getItem(g);if(!e)return{...m};let r=JSON.parse(e);if(!r||"object"!=typeof r)return console.warn("Invalid settings data in localStorage, using defaults"),{...m};return{...m,...r,llmProviders:(r.llmProviders||[]).map(e=>({id:e.id||u(),name:e.name||"openai",apiKey:"",baseUrl:e.baseUrl,models:e.models||[],enabled:!1!==e.enabled})),mcpServers:(r.mcpServers||[]).map(e=>({id:e.id||u(),name:e.name||"",command:e.command||"",args:Array.isArray(e.args)?e.args:[],env:e.env||{},enabled:!1!==e.enabled,status:e.status||"disconnected"})),preferences:{...m.preferences,...r.preferences}}}catch(e){return console.error("Failed to load settings from localStorage:",e),{...m}}},x=(0,d.v)()((0,c.Zr)((e,r)=>({...m,isLoading:!1,isSaving:!1,addLLMProvider:s=>{let t={...s,id:u()};e(e=>({llmProviders:[...e.llmProviders,t]})),r().saveSettings()},updateLLMProvider:(s,t)=>{console.log("\uD83D\uDD27 updateLLMProvider called:",{id:s,config:t}),e(e=>({llmProviders:e.llmProviders.map(e=>e.id===s?{...e,...t}:e)})),console.log("\uD83D\uDCBE Calling saveSettings after updateLLMProvider"),r().saveSettings()},removeLLMProvider:s=>{e(e=>({llmProviders:e.llmProviders.filter(e=>e.id!==s)})),r().saveSettings()},toggleLLMProvider:s=>{e(e=>({llmProviders:e.llmProviders.map(e=>e.id===s?{...e,enabled:!e.enabled}:e)})),r().saveSettings()},testLLMConnection:async(e,r)=>{throw Error("Connection testing should use the backend API endpoint")},addMCPServer:s=>{let t={...s,id:u(),status:"disconnected"};e(e=>({mcpServers:[...e.mcpServers,t]})),r().saveSettings()},updateMCPServer:(s,t)=>{e(e=>({mcpServers:e.mcpServers.map(e=>e.id===s?{...e,...t}:e)})),r().saveSettings()},removeMCPServer:s=>{e(e=>({mcpServers:e.mcpServers.filter(e=>e.id!==s)})),r().saveSettings()},toggleMCPServer:s=>{e(e=>({mcpServers:e.mcpServers.map(e=>e.id===s?{...e,enabled:!e.enabled}:e)})),r().saveSettings()},testMCPConnection:async e=>{if(!r().mcpServers.find(r=>r.id===e))return!1;try{return await new Promise(e=>setTimeout(e,1e3)),r().updateMCPServer(e,{status:"connected"}),!0}catch(s){return console.error("MCP connection test failed:",s),r().updateMCPServer(e,{status:"error"}),!1}},updatePreferences:s=>{let{theme:t,language:a,...n}=s;Object.keys(n).length>0&&(e(e=>({preferences:{...e.preferences,...n}})),r().saveSettings()),t&&(localStorage.setItem("mcp-chat-ui-theme",t),y(t)),a&&(localStorage.setItem("mcp-chat-ui-language",a),f(a))},changeLanguage:r=>{localStorage.setItem("mcp-chat-ui-language",r),f(r),e(e=>({preferences:{...e.preferences,language:r}}))},changeTheme:r=>{localStorage.setItem("mcp-chat-ui-theme",r),y(r),e(e=>({preferences:{...e.preferences,theme:r}}))},loadSettings:async()=>{console.log("\uD83D\uDCE5 loadSettings called - loading from backend"),e({isLoading:!0});try{let s=await fetch("/api/settings");if(s.ok){let r=await s.json();console.log("\uD83D\uDCCA Backend settings loaded:",r);let t=localStorage.getItem("mcp-chat-ui-theme")||"system",a=localStorage.getItem("mcp-chat-ui-language")||"en";e({llmProviders:r.llmProviders||m.llmProviders,mcpServers:r.mcpServers||m.mcpServers,preferences:{...m.preferences,...r.preferences,theme:t,language:a}})}else{console.warn("Failed to load settings from backend, using local storage");let r=p(),s=localStorage.getItem("mcp-chat-ui-theme")||"system",t=localStorage.getItem("mcp-chat-ui-language")||"en";e({...r,preferences:{...r.preferences,theme:s,language:t}})}let t=r();y(t.preferences.theme),await f(t.preferences.language),e({isLoading:!1})}catch(a){console.error("Failed to load settings from backend:",a);let r=p(),s=localStorage.getItem("mcp-chat-ui-theme")||"system",t=localStorage.getItem("mcp-chat-ui-language")||"en";e({...r,preferences:{...r.preferences,theme:s,language:t}}),y(s),await f(t),e({isLoading:!1})}},saveSettings:async()=>{console.log("\uD83D\uDCBE saveSettings called - saving to backend"),e({isSaving:!0});try{let s=r(),t=s.llmProviders.map(e=>{let r=e.apiKey;return!r||r.includes("•")||r.includes("*")||""===r.trim()||"••••"===r?{...e,apiKey:""}:e}),{theme:a,language:n,...o}=s.preferences,i={llmProviders:t,mcpServers:s.mcpServers,preferences:o},l={...i,llmProviders:i.llmProviders.map(e=>({...e,apiKey:e.apiKey?"***masked***":"(empty)"}))};console.log("\uD83D\uDCE4 Sending settings to backend:",JSON.stringify(l,null,2));let d=await fetch("/api/settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(d.ok){let r=await d.json();console.log("✅ Settings saved to backend"),e({llmProviders:r.llmProviders||i.llmProviders,mcpServers:r.mcpServers||i.mcpServers,preferences:r.preferences||i.preferences}),h(i)}else{let e="HTTP ".concat(d.status,": ").concat(d.statusText);try{let r=await d.json();r.message&&(e=r.message),console.error("❌ Backend error details:",r)}catch(e){console.error("❌ Failed to parse error response")}throw Error("Failed to save settings to backend: ".concat(e))}e({isSaving:!1})}catch(t){console.error("Failed to save settings:",t);let s=r();throw h({llmProviders:s.llmProviders,mcpServers:s.mcpServers,preferences:s.preferences}),e({isSaving:!1}),t}},resetSettings:()=>{e({...m}),localStorage.removeItem(g)},exportSettings:()=>{let e=r();return JSON.stringify({llmProviders:e.llmProviders,mcpServers:e.mcpServers,preferences:e.preferences},null,2)},importSettings:async s=>{try{if(!s||"string"!=typeof s)throw Error("Invalid settings JSON string");let t=JSON.parse(s);if(!t||"object"!=typeof t)throw Error("Invalid settings format: not an object");if(!Array.isArray(t.llmProviders))throw Error("Invalid settings format: llmProviders must be an array");if(!Array.isArray(t.mcpServers))throw Error("Invalid settings format: mcpServers must be an array");if(!t.preferences||"object"!=typeof t.preferences)throw Error("Invalid settings format: preferences must be an object");let a={llmProviders:t.llmProviders.map(e=>({id:e.id||u(),name:e.name||"openai",apiKey:"",baseUrl:e.baseUrl,models:Array.isArray(e.models)?e.models:[],enabled:!1!==e.enabled})),mcpServers:t.mcpServers.map(e=>({id:e.id||u(),name:e.name||"",command:e.command||"",args:Array.isArray(e.args)?e.args:[],env:e.env||{},enabled:!1!==e.enabled,status:e.status||"disconnected"})),preferences:{...m.preferences,...t.preferences}};return e({...m,...a}),await r().saveSettings(),!0}catch(e){return console.error("Failed to import settings:",e),!1}},importMCPServers:async s=>{try{let t=b(s);if(0===t.length)throw Error("No valid MCP servers found in configuration");return e(e=>({mcpServers:[...e.mcpServers,...t]})),await r().saveSettings(),!0}catch(e){return console.error("Failed to import MCP servers:",e),!1}}}),{name:g,partialize:e=>({llmProviders:e.llmProviders,mcpServers:e.mcpServers,preferences:e.preferences}),onRehydrateStorage:()=>e=>{e&&(Array.isArray(e.llmProviders)||(e.llmProviders=[]),Array.isArray(e.mcpServers)||(e.mcpServers=[]),e.preferences||(e.preferences=m.preferences))}})),b=e=>{try{let r=JSON.parse(e);if(r.mcpServers&&"object"==typeof r.mcpServers)return Object.entries(r.mcpServers).map(e=>{let[r,s]=e;return{id:u(),name:r,command:s.command||"",args:Array.isArray(s.args)?s.args:[],env:s.env||{},enabled:!1!==s.enabled,status:"disconnected"}});if(Array.isArray(r))return r.map(e=>({id:u(),name:e.name||"",command:e.command||"",args:Array.isArray(e.args)?e.args:[],env:e.env||{},enabled:!1!==e.enabled,status:"disconnected"}));return[]}catch(e){return console.error("Failed to parse MCP servers JSON:",e),[]}},v=null,y=e=>{let r=document.documentElement;if(v&&(window.matchMedia("(prefers-color-scheme: dark)").removeEventListener("change",v),v=null),"dark"===e)r.classList.add("dark"),console.log("\uD83C\uDF19 Applied dark theme");else if("light"===e)r.classList.remove("dark"),console.log("☀️ Applied light theme");else{let e=()=>{window.matchMedia("(prefers-color-scheme: dark)").matches?(r.classList.add("dark"),console.log("\uD83C\uDF19 Applied system dark theme")):(r.classList.remove("dark"),console.log("☀️ Applied system light theme"))};e();let s=window.matchMedia("(prefers-color-scheme: dark)");v=()=>e(),s.addEventListener("change",v)}},f=async e=>{try{let{default:r}=await Promise.all([s.e(211),s.e(360)]).then(s.bind(s,1360));await r.changeLanguage(e),localStorage.setItem("i18nextLng",e)}catch(e){console.warn("Failed to update i18n language:",e)}};var j=s(7217);let k=()=>Date.now().toString(36)+Math.random().toString(36).substr(2),N=e=>{let r=e.find(e=>"user"===e.role);if(!r)return"New Chat";let s=r.content.trim();return s.length<=50?s:s.substring(0,47)+"..."};(0,d.v)()((0,c.Zr)((e,r)=>({currentSession:null,messages:[],isLoading:!1,pendingToolCall:null,sessions:[],isLoadingSessions:!1,error:null,sendMessage:async s=>{console.log("\uD83D\uDE80 sendMessage called with:",s);let{currentSession:t,addMessage:a,saveSession:n}=r();if(!t)throw console.error("❌ No active session"),Error("No active session");console.log("\uD83D\uDCDD Current session:",t);let o={role:"user",content:s.trim()};console.log("➕ Adding user message:",o),a(o),e({isLoading:!0,error:null});try{console.log("\uD83D\uDD27 Getting settings...");let s=x.getState();console.log("⚙️ Settings store:",s);let o=s.llmProviders.find(e=>e.name===t.provider&&e.enabled);if(console.log("\uD83D\uDD0D Found provider:",o),!o)throw console.error("❌ No valid provider found"),Error("No valid ".concat(t.provider," provider configuration found. Please check your settings."));let i={messages:r().messages,sessionId:t.id,provider:t.provider,model:t.model,baseUrl:o.baseUrl};console.log("\uD83D\uDCE4 Sending chat request:",{...i});let l=await j.Pt.sendMessage(i);if(l.error)throw Error(l.error);if(l.toolCalls&&l.toolCalls.length>0){let r={role:"assistant",content:l.reply||"I need to use a tool to help with your request.",toolCalls:l.toolCalls};a(r),e({pendingToolCall:l.toolCalls[0]})}else if(l.reply){let e={role:"assistant",content:l.reply};a(e)}n()}catch(s){console.error("Error sending message:",s);let r=s instanceof Error?s.message:"Unknown error occurred";throw e({error:r}),a({role:"assistant",content:"I encountered an error: ".concat(r,". Please try again or check your settings.")}),n(),s}finally{e({isLoading:!1})}},confirmToolCall:async s=>{let{currentSession:t,addMessage:a,saveSession:n}=r();if(!t)throw Error("No active session");e({isLoading:!0,pendingToolCall:null,error:null});try{let e={toolCall:s,sessionId:t.id,messages:r().messages},o=await j.Pt.runTool(e);if(o.error)throw Error(o.error);let i={role:"tool",content:o.result,toolCallId:s.id};if(a(i),o.reply){let e={role:"assistant",content:o.reply};a(e)}n()}catch(s){console.error("Error executing tool:",s);let r=s instanceof Error?s.message:"Unknown error occurred";throw e({error:r}),a({role:"assistant",content:"Tool execution failed: ".concat(r,". Please try again.")}),n(),s}finally{e({isLoading:!1})}},cancelToolCall:()=>{let{currentSession:s,addMessage:t,saveSession:a}=r();s&&(e({pendingToolCall:null}),t({role:"assistant",content:"Tool execution was cancelled by the user."}),a())},loadSession:async s=>{let{sessions:t}=r(),a=t.find(e=>e.id===s);if(!a)try{a=await j.Pt.getSession(s),e(e=>({sessions:[a,...e.sessions.filter(e=>e.id!==s)]}))}catch(e){throw console.error("Failed to load session from backend:",e),Error("Session ".concat(s," not found"))}e({currentSession:a,messages:a.messages,pendingToolCall:null,isLoading:!1})},createNewSession:function(s,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n={id:k(),title:"New Chat",messages:[],createdAt:new Date,updatedAt:new Date,provider:s,model:t,mcpServers:a};e(e=>({currentSession:n,messages:[],sessions:[n,...e.sessions],pendingToolCall:null,isLoading:!1})),r().saveSession()},updateSessionTitle:(s,t)=>{e(e=>{var r;return{sessions:e.sessions.map(e=>e.id===s?{...e,title:t,updatedAt:new Date}:e),currentSession:(null==(r=e.currentSession)?void 0:r.id)===s?{...e.currentSession,title:t,updatedAt:new Date}:e.currentSession}}),r().saveSession()},deleteSession:s=>{e(e=>{var r;let t=e.sessions.filter(e=>e.id!==s),a=(null==(r=e.currentSession)?void 0:r.id)===s?null:e.currentSession;return{sessions:t,currentSession:a,messages:(null==a?void 0:a.messages)||[]}}),r().saveSession()},archiveSession:e=>{r().deleteSession(e)},searchSessions:e=>{let{sessions:s}=r();if(!Array.isArray(s))return[];if(!e.trim())return s;let t=e.toLowerCase();return s.filter(e=>!!e.title.toLowerCase().includes(t)||e.messages.some(e=>e.content.toLowerCase().includes(t)))},addMessage:s=>{let t={...s,id:k(),timestamp:new Date};e(e=>{let r=[...e.messages,t],s=e.currentSession?{...e.currentSession,messages:r,updatedAt:new Date,title:"New Chat"===e.currentSession.title&&"user"===t.role?N([t]):e.currentSession.title}:null,a=e.sessions.map(e=>e.id===(null==s?void 0:s.id)?s:e);return{messages:r,currentSession:s,sessions:a}});let{currentSession:a}=r();a&&"New Chat"===a.title&&"assistant"===t.role&&a.messages.length>=2&&j.Pt.generateSessionTitle(a.id).then(e=>{r().updateSessionTitle(a.id,e.title)}).catch(e=>{console.warn("Failed to generate session title:",e)})},updateMessage:(s,t)=>{e(e=>{let r=e.messages.map(e=>e.id===s?{...e,...t}:e),a=e.currentSession?{...e.currentSession,messages:r,updatedAt:new Date}:null,n=e.sessions.map(e=>e.id===(null==a?void 0:a.id)?a:e);return{messages:r,currentSession:a,sessions:n}}),r().saveSession()},deleteMessage:s=>{e(e=>{let r=e.messages.filter(e=>e.id!==s),t=e.currentSession?{...e.currentSession,messages:r,updatedAt:new Date}:null,a=e.sessions.map(e=>e.id===(null==t?void 0:t.id)?t:e);return{messages:r,currentSession:t,sessions:a}}),r().saveSession()},saveSession:()=>{},loadSessions:async()=>{e({isLoadingSessions:!0,error:null});try{let r=await j.Pt.getChatHistory();if(!r||!Array.isArray(r.sessions))throw Error("Invalid response format from server");let s=r.sessions.map(e=>({id:e.id,title:e.title,messages:[],createdAt:e.createdAt?new Date(e.createdAt):new Date,updatedAt:e.updatedAt?new Date(e.updatedAt):new Date,provider:e.provider,model:e.model,mcpServers:[]}));e(e=>{let r=Array.isArray(e.sessions)?e.sessions:[],t=[...s];return r.forEach(e=>{s.find(r=>r.id===e.id)||t.push(e)}),t.sort((e,r)=>{let s=e.updatedAt instanceof Date?e.updatedAt.getTime():0;return(r.updatedAt instanceof Date?r.updatedAt.getTime():0)-s}),{sessions:t,isLoadingSessions:!1}})}catch(r){console.error("Failed to load sessions from backend:",r),e(e=>({isLoadingSessions:!1,error:"Failed to load chat history from server",sessions:Array.isArray(e.sessions)?e.sessions:[]}))}},initializeStore:async()=>{await r().loadSessions()},setPendingToolCall:r=>{e({pendingToolCall:r})},setLoading:r=>{e({isLoading:r})},setError:r=>{e({error:r})},generateSessionTitle:e=>N(e),clearCurrentSession:()=>{e({currentSession:null,messages:[],pendingToolCall:null,isLoading:!1})}}),{name:"chat-store",storage:(0,c.KU)(()=>localStorage),partialize:e=>({sessions:Array.isArray(e.sessions)?e.sessions:[],currentSession:e.currentSession,messages:e.messages||[]}),onRehydrateStorage:()=>e=>{e&&(Array.isArray(e.sessions)||(e.sessions=[]),Array.isArray(e.messages)||(e.messages=[]),e.isLoading=!1,e.pendingToolCall=null,e.error=null)}})),(0,d.v)(e=>({isLoading:!1,setLoading:r=>e({isLoading:r})}));let w=["en","zh"],S={en:"English",zh:"中文"},C=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"polite",s=document.createElement("div");s.setAttribute("aria-live",r),s.setAttribute("aria-atomic","true"),s.className="sr-only",s.textContent=e,document.body.appendChild(s),setTimeout(()=>{document.body.removeChild(s)},1e3)},P=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r="focus:outline-none focus:ring-2 focus:ring-offset-2";return e?"".concat(r," focus:ring-black dark:focus:ring-white focus:ring-offset-white dark:focus:ring-offset-black"):"".concat(r," focus:ring-blue-500 focus:ring-offset-white dark:focus:ring-offset-gray-800")},T=e=>{let{className:r=""}=e,{t:s}=(0,l.Bd)(),n=(0,i.useRouter)(),{theme:o,changeTheme:d}=(()=>{let[e,r]=(0,a.useState)("system"),[s,t]=(0,a.useState)("light");return(0,a.useEffect)(()=>{let e=localStorage.getItem("mcp-chat-ui-theme");e&&["light","dark","system"].includes(e)?r(e):r("system")},[]),(0,a.useEffect)(()=>{let r=()=>{let r,s=document.documentElement;"dark"===(r="system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e)?s.classList.add("dark"):s.classList.remove("dark"),t(r)};if(r(),"system"===e){let e=window.matchMedia("(prefers-color-scheme: dark)"),s=()=>r();return e.addEventListener("change",s),()=>e.removeEventListener("change",s)}},[e]),{theme:e,resolvedTheme:s,changeTheme:e=>{r(e),localStorage.setItem("mcp-chat-ui-theme",e)},isDark:"dark"===s,isLight:"light"===s}})(),{currentLanguage:c,changeLanguage:m,supportedLanguages:u,getLanguageName:g}=(()=>{let{i18n:e}=(0,l.Bd)(),{preferences:r,changeLanguage:s}=x(),t=r.language,n=(0,a.useCallback)(async r=>{try{await e.changeLanguage(r),s(r)}catch(e){console.error("Failed to change language:",e)}},[e,s]);return{currentLanguage:t,changeLanguage:n,isLanguageSupported:(0,a.useCallback)(e=>w.includes(e),[]),getLanguageName:(0,a.useCallback)(e=>S[e],[]),supportedLanguages:w,languageNames:S}})(),{userPreferences:h,updatePreferences:p}=(()=>{let{preferences:e,updatePreferences:r}=x(),s=e.accessibility||{highContrast:!1,reducedMotion:!1,screenReaderAnnouncements:!0,keyboardNavigation:!0,focusVisible:!0,largeText:!1},[t,n]=(0,a.useState)({reducedMotion:window.matchMedia("(prefers-reduced-motion: reduce)").matches,highContrast:window.matchMedia("(prefers-contrast: high)").matches});(0,a.useEffect)(()=>{let e=window.matchMedia("(prefers-reduced-motion: reduce)"),r=window.matchMedia("(prefers-contrast: high)"),s=e=>{n(r=>({...r,reducedMotion:e.matches}))},t=e=>{n(r=>({...r,highContrast:e.matches}))};return e.addEventListener("change",s),r.addEventListener("change",t),()=>{e.removeEventListener("change",s),r.removeEventListener("change",t)}},[]);let o=(0,a.useCallback)(e=>{r({accessibility:{...s,...e}})},[s,r]),i=(0,a.useCallback)(function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"polite";s.screenReaderAnnouncements&&C(e,r)},[s.screenReaderAnnouncements]),l={highContrast:s.highContrast||t.highContrast,reducedMotion:s.reducedMotion||t.reducedMotion,screenReaderAnnouncements:s.screenReaderAnnouncements,keyboardNavigation:s.keyboardNavigation,focusVisible:s.focusVisible,largeText:s.largeText},d=P(l.highContrast);return(0,a.useEffect)(()=>{let e=document.documentElement;l.highContrast?e.classList.add("high-contrast"):e.classList.remove("high-contrast"),l.reducedMotion?e.classList.add("reduce-motion"):e.classList.remove("reduce-motion"),l.largeText?e.classList.add("large-text"):e.classList.remove("large-text"),l.focusVisible?e.classList.add("focus-visible"):e.classList.remove("focus-visible")},[l]),{preferences:l,userPreferences:s,systemPreferences:t,updatePreferences:o,announce:i,focusRingClasses:d}})(),{preferences:b,updatePreferences:v}=x(),[y,f]=(0,a.useState)(!1),j=async e=>{if(e!==c){f(!0);try{await m(e),v({language:e}),await n.push(n.asPath,n.asPath,{locale:e})}catch(e){console.error("Failed to change language:",e)}finally{f(!1)}}},k=(e,r)=>{v({[e]:r})},N=(e,r)=>{p({[e]:r})},T=e=>{let{id:r,label:s,description:a,checked:n,onChange:o,disabled:i=!1}=e;return(0,t.jsxs)("div",{className:"flex items-center justify-between py-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{htmlFor:r,className:"text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer",children:s}),(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:a})]}),(0,t.jsxs)("button",{id:r,type:"button",role:"switch","aria-checked":n,"aria-describedby":"".concat(r,"-description"),onClick:()=>o(!n),disabled:i,className:"\n          relative inline-flex h-6 w-11 items-center rounded-full transition-colors\n          focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\n          disabled:opacity-50 disabled:cursor-not-allowed\n          ".concat(n?"bg-blue-600":"bg-gray-200 dark:bg-gray-700","\n        "),children:[(0,t.jsx)("span",{className:"sr-only",children:s}),(0,t.jsx)("span",{className:"\n            inline-block h-4 w-4 transform rounded-full bg-white transition-transform\n            ".concat(n?"translate-x-6":"translate-x-1","\n          ")})]}),(0,t.jsx)("div",{id:"".concat(r,"-description"),className:"sr-only",children:a})]})},A=e=>{let{id:r,label:s,description:a,value:n,options:o,onChange:i,disabled:l=!1}=e;return(0,t.jsxs)("div",{className:"py-3",children:[(0,t.jsx)("label",{htmlFor:r,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s}),(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:a}),(0,t.jsx)("select",{id:r,value:n,onChange:e=>i(e.target.value),disabled:l,className:" block w-full px-3 py-2 border border-gray-300 dark:border-gray-600  rounded-md shadow-sm bg-white dark:bg-gray-800  text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50 disabled:cursor-not-allowed ",children:o.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]})};return(0,t.jsxs)("div",{className:"space-y-6 ".concat(r),children:[(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-4",children:s("settings.general","General")}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(A,{id:"language-select",label:s("settings.language","Language"),description:s("settings.languageDescription","Choose your preferred language for the interface"),value:c,options:u.map(e=>({value:e,label:g(e)})),onChange:j,disabled:y}),(0,t.jsx)(A,{id:"theme-select",label:s("settings.theme","Theme"),description:s("settings.themeDescription","Choose your preferred color theme"),value:o,options:[{value:"light",label:s("themes.light","Light")},{value:"dark",label:s("themes.dark","Dark")},{value:"system",label:s("themes.system","System")}],onChange:e=>(e=>{d(e),v({theme:e})})(e)})]})]}),(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-4",children:s("settings.preferences","Preferences")}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(T,{id:"auto-scroll",label:s("settings.autoScroll","Auto-scroll"),description:s("settings.autoScrollDescription","Automatically scroll to new messages"),checked:b.autoScroll,onChange:e=>k("autoScroll",e)}),(0,t.jsx)(T,{id:"sound-enabled",label:s("settings.soundEnabled","Sound notifications"),description:s("settings.soundEnabledDescription","Play sounds for notifications"),checked:b.soundEnabled,onChange:e=>k("soundEnabled",e)})]})]}),(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-4",children:s("accessibility.title","Accessibility")}),(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:s("accessibility.description","Configure accessibility features to improve your experience")}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(T,{id:"high-contrast",label:s("accessibility.highContrast","High Contrast Mode"),description:s("accessibility.highContrastDescription","Increase contrast for better visibility"),checked:h.highContrast,onChange:e=>N("highContrast",e)}),(0,t.jsx)(T,{id:"large-text",label:s("accessibility.largeText","Large Text"),description:s("accessibility.largeTextDescription","Increase text size throughout the interface"),checked:h.largeText,onChange:e=>N("largeText",e)}),(0,t.jsx)(T,{id:"reduced-motion",label:s("accessibility.reducedMotion","Reduce Motion"),description:s("accessibility.reducedMotionDescription","Minimize animations and transitions"),checked:h.reducedMotion,onChange:e=>N("reducedMotion",e)}),(0,t.jsx)(T,{id:"focus-visible",label:s("accessibility.focusVisible","Enhanced Focus Indicators"),description:s("accessibility.focusVisibleDescription","Show clear focus indicators for keyboard navigation"),checked:h.focusVisible,onChange:e=>N("focusVisible",e)}),(0,t.jsx)(T,{id:"keyboard-navigation",label:s("accessibility.keyboardNavigation","Enhanced Keyboard Navigation"),description:s("accessibility.keyboardNavigationDescription","Improve keyboard navigation with arrow keys and shortcuts"),checked:h.keyboardNavigation,onChange:e=>N("keyboardNavigation",e)}),(0,t.jsx)(T,{id:"screen-reader-announcements",label:s("accessibility.screenReaderAnnouncements","Screen Reader Announcements"),description:s("accessibility.screenReaderAnnouncementsDescription","Announce important changes and updates to screen readers"),checked:h.screenReaderAnnouncements,onChange:e=>N("screenReaderAnnouncements",e)})]})]}),(0,t.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-start",children:[(0,t.jsx)("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsxs)("div",{className:"ml-3",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-2",children:s("accessibility.wcagCompliance","WCAG 2.1 AA Compliance")}),(0,t.jsx)("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:s("accessibility.wcagDescription","This application follows Web Content Accessibility Guidelines (WCAG) 2.1 AA standards to ensure accessibility for all users.")})]})]})})]})};function A(e){let{language:r,serverSettings:s}=e,[i,l]=(0,a.useState)("llm"),d="zh"===r?{settings:"设置",backToChat:"← 返回聊天",history:"历史记录",llmProviders:"LLM 提供商",mcpServers:"MCP 服务器",preferences:"偏好设置",security:"安全",dataExport:"数据导出",providerConfiguration:"LLM 提供商配置",providerStatus:"提供商状态",connected:"已连接",pending:"待配置",error:"错误",providerManagement:"提供商管理",addProvider:"添加提供商",note:"注意",singleUserNote:"这是单用户部署。API密钥在服务器端管理，从不暴露给客户端。",sessionNote:"创建新聊天会话时，您将从此处配置的提供商中选择。所有凭据都安全存储在服务器上。"}:{settings:"Settings",backToChat:"← Back to Chat",history:"History",llmProviders:"LLM Providers",mcpServers:"MCP Servers",preferences:"Preferences",security:"Security",dataExport:"Data Export",providerConfiguration:"LLM Provider Configuration",providerStatus:"Provider Status",connected:"Connected",pending:"Pending",error:"Error",providerManagement:"Provider Management",addProvider:"Add Provider",note:"Note",singleUserNote:"This is a single-user deployment. API keys are managed server-side and never exposed to the client.",sessionNote:"When creating new chat sessions, you'll select from providers configured here. All credentials remain securely stored on the server."};return(0,t.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,t.jsxs)("div",{className:"grid md:grid-cols-4 gap-8",children:[(0,t.jsx)("div",{className:"md:col-span-1",children:(0,t.jsxs)("nav",{className:"space-y-2",children:[(0,t.jsx)("button",{onClick:()=>l("llm"),className:"w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("llm"===i?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent"),children:d.llmProviders}),(0,t.jsx)("button",{onClick:()=>l("mcp"),className:"w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("mcp"===i?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent"),children:d.mcpServers}),(0,t.jsx)("button",{onClick:()=>l("preferences"),className:"w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("preferences"===i?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent"),children:d.preferences}),(0,t.jsx)("button",{onClick:()=>l("security"),className:"w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("security"===i?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent"),children:d.security}),(0,t.jsx)("button",{onClick:()=>l("export"),className:"w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("export"===i?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent"),children:d.dataExport})]})}),(0,t.jsx)("div",{className:"md:col-span-3",children:(0,t.jsx)("div",{className:"bg-card border rounded-lg p-6",children:(()=>{switch(i){case"llm":return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-medium mb-4",children:d.providerStatus}),(0,t.jsx)("div",{className:"space-y-3",children:s.llmProviders.map(e=>{let s="connected"===e.status?"bg-green-500":"error"===e.status?"bg-red-500":"bg-yellow-500",a="connected"===e.status?d.connected:"error"===e.status?d.error:d.pending,n="connected"===e.status?"text-green-600":"error"===e.status?"text-red-600":"text-yellow-600";return(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(s)}),(0,t.jsx)("span",{className:"font-medium",children:e.displayName}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:e.models.length>0?e.models.map(e=>e.displayName).join(", "):"zh"===r?"未配置":"Not configured"})]}),(0,t.jsx)("span",{className:"text-sm ".concat(n),children:a})]},e.id)})})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:d.providerManagement}),(0,t.jsx)("button",{className:"inline-flex items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition-colors",children:d.addProvider})]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground bg-muted/30 p-4 rounded-lg",children:[(0,t.jsxs)("p",{className:"mb-2",children:[(0,t.jsxs)("strong",{children:[d.note,":"]})," ",d.singleUserNote]}),(0,t.jsx)("p",{children:d.sessionNote})]})]}),(0,t.jsx)(n,{language:r})]});case"mcp":return(0,t.jsxs)("div",{className:"space-y-6",children:[s.mcpServers.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-medium mb-4",children:d.mcpServers}),(0,t.jsx)("div",{className:"space-y-3",children:s.mcpServers.map(e=>{let s="connected"===e.status?"bg-green-500":"error"===e.status?"bg-red-500":"bg-yellow-500",a="connected"===e.status?d.connected:"error"===e.status?d.error:d.pending,n="connected"===e.status?"text-green-600":"error"===e.status?"text-red-600":"text-yellow-600";return(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(s)}),(0,t.jsx)("span",{className:"font-medium",children:e.displayName}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:e.toolCount>0?"".concat(e.toolCount," ").concat("zh"===r?"个工具":"tools"):"zh"===r?"无工具":"No tools"})]}),(0,t.jsx)("span",{className:"text-sm ".concat(n),children:a})]},e.id)})})]}),(0,t.jsx)(o,{language:r})]});case"preferences":return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:d.preferences}),(0,t.jsx)(T,{})]});case"security":return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:d.security}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Security settings coming soon..."})]});case"export":return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:d.dataExport}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Data export options coming soon..."})]});default:return null}})()})})]})})}},4522:(e,r,s)=>{Promise.resolve().then(s.bind(s,4649)),Promise.resolve().then(s.bind(s,2358)),Promise.resolve().then(s.bind(s,9505)),Promise.resolve().then(s.bind(s,7274)),Promise.resolve().then(s.bind(s,3521))}},e=>{e.O(0,[32,977,441,964,358],()=>e(e.s=4522)),_N_E=e.O()}]);